{"version":3,"sources":["/home/runner/work/proc-app/proc-app/out/process-co/ui/dist/index.js","../src/lib/utils.ts","../src/components/ui/input.tsx","../src/stores/expressionModeStore.ts","../src/hooks/useExpressionMode.ts","../src/components/expression/ExpressionEditor.tsx","../src/hooks/useASTParser.ts","../src/components/expression/ASTRenderer.tsx","../src/components/expression/ExpressionWrapper.tsx","../src/components/input.tsx","../../../node_modules/.pnpm/class-variance-authority@0.7.1/node_modules/class-variance-authority/dist/index.mjs","../src/components/ui/button.tsx"],"names":["p","p__default","useState","useCallback","useEffect","useMemo","useRef","pi","clsx","twMerge","create","Editor","FontAwesomeIcon","faExpand","faSpinner","Slot","cn","inputs","Input","className","wrapperClassName","type","required","error","props","te","createElement","defaultState","expression","mode","isEditing","currentValue","isFullScreen","useExpressionModeStore","set","get","states","setState","fieldName","state","store","getState","clear","switchToValue","currentState","switchToExpression","switchToEditor","setExpression","setEditing","setFullScreen","setCurrentValue","value","useExpressionMode","expr","editing","current","isExpressionMode","isEditorMode","inferTypeFromMonaco","editor","monaco","logPrefix","currentModel","wrappedCode","tempModel","client","exprIndex","position","quickInfo","extractedType","foundColon","typeParts","part","prevPart","typeString","trim","console","log","hasTextFocus","getModel","getModelMarkers","resource","uri","some","marker","severity","MarkerSeverity","Error","createModel","languages","typescript","getTypeScriptWorker","indexOf","getPositionAt","getQuickInfoAtPosition","toString","getOffsetAt","displayParts","push","kind","text","length","map","join","dispose","warn","InlineEditorOptions","fontSize","fontWeight","wordWrap","lineNumbers","lineNumbersMinChars","overviewRulerLanes","overviewRulerBorder","hideCursorInOverviewRuler","lineDecorationsWidth","glyphMargin","folding","scrollBeyondLastColumn","scrollbar","horizontal","vertical","alwaysConsumeMouseWheel","find","addExtraSpaceOnTop","autoFindInSelection","seedSearchStringFromSelection","minimap","enabled","wordBasedSuggestions","links","occurrencesHighlight","cursorStyle","renderLineHighlight","contextmenu","roundedSelection","hover","delay","acceptSuggestionOnEnter","automaticLayout","fixedOverflowWidgets","padding","top","bottom","fontFamily","letterSpacing","lineHeight","FullPanelEditorOptions","readOnly","domReadOnly","InlineExpressionEditor","onChange","onBlur","onEnter","onTypeInferred","onValidationChange","context","placeholder","editorRef","monacoRef","typeInferenceTimeoutRef","handleEditorWillMount","contextKeys","Object","keys","javascriptDefaults","addExtraLib","handleEditorDidMount","updateOptions","getDomNode","findCommand","addCommand","KeyMod","CtrlCmd","KeyCode","KEY_F","enterKeyDisposable","onKeyDown","e","keyCode","Enter","shiftKey","preventDefault","stopPropagation","suggestWidget","_contentWidgets","isSuggestVisible","widget","_hidden","suggestWidgetVisible","_contextKeyService","getContextKeyValue","trigger","onDidPaste","endLineNumber","newContent","textModel","lineCount","getLineCount","i","getLineContent","setValue","setPosition","column","lineNumber","onDidBlurEditorText","getValue","onDidChangeModelContent","model","markers","hasErrors","clearTimeout","setTimeout","expressionToAnalyze","inferredType","markerChangeDisposable","onDidChangeMarkers","uris","F1","cursorDisposable","onDidChangeCursorPosition","window","requestAnimationFrame","focus","_inlineDisposables","disposables","handleEditorChange","newValue","React","theme","height","language","onMount","beforeMount","width","loading","Fragment","icon","options","FullPanelExpressionEditor","onClose","handleFPEditorDidMount","getOption","EditorOption","escapeKeyDisposable","Escape","changeCount","changeDisposable","lastLineLength","getLineLength","_fullScreenDisposables","onClick","useASTParser","controlKey","ast","setAST","tokens","setTokens","dependencies","setDependencies","isLoading","setIsLoading","setError","requestIdRef","messageHandlerRef","controlKeyRef","navigator","serviceWorker","handleMessage","event","data","payload","id","result","receivedId","expectedId","receivedKey","expectedKey","addEventListener","removeEventListener","controller","postMessage","ASTRenderer","key","variant","showTokens","getNodeColor","renderInlineNode","node","depth","start","end","name","left","operator","right","callee","object","property","renderTreeNode","indent","repeat","argument","index","children","slice","child","renderTokens","displayTokens","token","includes","ExpressionWrapper","label","valuesLoading","onValueChange","onDependenciesChange","metadata","expressionContext","availableNodes","myInterface","contextTypeDefinitions","inlineEditor","editorClassName","expressionPlaceholder","evaluateExpression","expressionResult","isEvaluating","isExpressionValid","expectedType","expressionMetadata","setExpressionMetadata","originalValue","setOriginalValue","formatValue","isNaN","parseFloat","parseInt","split","currentEditorValue","setCurrentEditorValue","currentExpressionValueExt","isExpressionValue","isInitialMount","exprValue","exprString","expressionMode","isMetadataOutOfSync","syncedMetadata","isParsing","parseError","dependencyList","dep","exists","typeScriptInferredType","setTypeScriptInferredType","handleTypeInferred","expressionHasNewlines","inferredReturnType","hasTypeMismatch","normalizedInferred","toLowerCase","normalizedExpected","endsWith","startsWith","test","internalExpressionResult","setInternalExpressionResult","internalIsEvaluating","setInternalIsEvaluating","isHovering","setIsHovering","internalIsExpressionValid","setInternalIsExpressionValid","syntax","security","validationState","setValidationState","hasExpressionError","isProgrammaticallyClearing","isSwitchingToFullScreen","isBlur","handleValidationChange","isValid","errors","prev","checkForMultiLine","hasNewlines","isLong","internalEvaluateExpression","color","message","validation","currentMetadata","currentExpressionValue","handleValueChange","handleExpressionChange","newExpression","handleExpressionBlur","forceBlur","handleModeChange","newMode","shouldBeFullScreen","editorMetadata","handleClear","localInput","setLocalInput","controlProps","onExpressionClick","hasError","renderContent","onMouseDown","title","JSON","stringify","onMouseEnter","onMouseLeave","htmlFor","localValue","setLocalValue","localMetadata","setLocalMetadata","ee","val","onChangeExpression","expressionValue","target","falsyToString","cx","cva","base","config","_config_compoundVariants","variants","class","defaultVariants","getVariantClassNames","variantProp","defaultVariantProp","variantKey","propsWithoutUndefined","entries","reduce","acc","param","getCompoundVariantClassNames","compoundVariants","cvClass","cvClassName","compoundVariantOptions","every","Array","isArray","buttonVariants","default","destructive","outline","secondary","ghost","link","size","sm","lg","Button","asChild","Je","xt","ut","yi"],"mappings":"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","sourcesContent":["import*as p from'react';import p__default,{useState,useCallback,useEffect,useMemo,useRef}from'react';import pi,{clsx}from'clsx';import {twMerge}from'tailwind-merge';import {create}from'zustand';import {Editor}from'@monaco-editor/react';import {FontAwesomeIcon}from'@fortawesome/react-fontawesome';import {faExpand,faSpinner}from'@fortawesome/pro-regular-svg-icons';import {Slot}from'@radix-ui/react-slot';function M(...u){return twMerge(clsx(u))}function Ie({className:u,wrapperClassName:i,type:t,required:c,error:o,...f}){return p.createElement(\"div\",{className:M(\"uii:relative\",i)},p.createElement(\"input\",{\"aria-invalid\":o,type:t,\"data-slot\":\"input\",className:M(\"uii:border-input uii:file:text-foreground uii:placeholder:text-muted-foreground uii:selection:bg-primary uii:selection:text-primary-foreground uii:flex uii:h-9 uii:w-full uii:min-w-0 uii:rounded-sm uii:border uii:bg-transparent uii:px-3 uii:py-1 uii:text-base uii:shadow-xs uii:transition-[color,box-shadow] uii:outline-none uii:file:inline-flex uii:file:h-7 uii:file:border-0 uii:file:bg-transparent uii:file:text-sm uii:file:font-medium uii:disabled:pointer-events-none uii:disabled:cursor-not-allowed uii:disabled:opacity-50 uii:md:text-sm\",\"uii:focus-visible:border-ring uii:focus-visible:ring-ring/50 uii:focus-visible:ring-[3px]\",\"uii:aria-invalid:ring-destructive/20 uii:dark:aria-invalid:ring-destructive/40 uii:aria-invalid:border-destructive\",{\"uii:pr-30\":o},u),...f}),o&&p.createElement(\"span\",{className:\"uii:absolute uii:inset-y-0 uii:right-0 uii:flex uii:items-center uii:pr-2 uii:border-l-10 uii:border-l-background uii:my-[6px] uii:pointer-events-none \"},p.createElement(\"span\",{className:\"uii:bg-destructive uii:text-white uii:px-1.5 uii:py-1.5 uii:rounded-xs uii:uppercase uii:tracking-wide uii:font-medium uii:text-xs uii:leading-none uii:font-sans\"},o&&c?\"required\":\"error\")))}var Le={expression:\"\",mode:\"value\",isEditing:false,currentValue:void 0,isFullScreen:false},le=create((u,i)=>({states:{},setState:(t,c)=>{u(o=>({states:{...o.states,[t]:c}}));},getState:t=>i().states[t]||Le,clear:t=>{u(c=>({states:{...c.states,[t]:Le}}));},switchToValue:t=>{let c=i().getState(t);i().setState(t,{...c,mode:\"value\",isEditing:false});},switchToExpression:t=>{let c=i().getState(t);i().setState(t,{...c,mode:\"expression\",isEditing:false});},switchToEditor:t=>{let c=i().getState(t);i().setState(t,{...c,mode:\"expression\",isEditing:true});},setExpression:(t,c)=>{let o=i().getState(t);i().setState(t,{...o,expression:c});},setEditing:(t,c)=>{let o=i().getState(t);i().setState(t,{...o,isEditing:c});},setFullScreen:(t,c)=>{let o=i().getState(t);i().setState(t,{...o,isFullScreen:c});},setCurrentValue:(t,c)=>{let o=i().getState(t);i().setState(t,{...o,currentValue:c});}}));function Pe(u){let i=le(),t=i.getState(u),c=useCallback(()=>{i.switchToValue(u);},[i,u]),o=useCallback(()=>{i.switchToExpression(u);},[i,u]),f=useCallback(()=>{i.switchToEditor(u);},[i,u]),N=useCallback(()=>{i.clear(u);},[i,u]),m=useCallback(n=>{i.setExpression(u,n);},[i,u]),b=useCallback(n=>{i.setEditing(u,n);},[i,u]),y=useCallback(n=>{i.setCurrentValue(u,n);},[i,u]),e=useCallback(n=>{i.setFullScreen(u,n);},[i,u]);return {current:t.mode,switchToValue:c,switchToExpression:o,switchToEditor:f,clear:N,isExpressionMode:t.mode===\"expression\",isEditorMode:t.isEditing,expression:t.expression,setExpression:m,isEditing:t.isEditing,setEditing:b,currentValue:t.currentValue,setCurrentValue:y,isFullScreen:t.isFullScreen,setFullScreen:e}}async function q(u,i,t,c=\"\\u{1F537}\"){if(!t.trim())return console.log(`${c} Type inference skipped - no expression`),null;if(!u.hasTextFocus())return console.log(`${c} Skipping type inference - editor does not have focus`),null;console.log(`${c} Running type inference, expression:`,t);try{let o=u.getModel();if(o&&i.editor.getModelMarkers({resource:o.uri}).some(s=>s.severity===i.MarkerSeverity.Error))return console.log(`${c} Type inference skipped - expression has validation errors`),\"error\";let f=`const __expr__ = (${t});`,N=i.editor.createModel(f,\"typescript\"),b=await(await i.languages.typescript.getTypeScriptWorker())(N.uri),y=f.indexOf(\"__expr__\"),e=N.getPositionAt(y),n=await b.getQuickInfoAtPosition(N.uri.toString(),N.getOffsetAt(e));console.log(`${c} QuickInfo response:`,n);let S=null;if(n&&n.displayParts){let C=!1,d=[];for(let s of n.displayParts)if(C&&d.push(s),s.kind===\"punctuation\"&&s.text===\":\"&&!C){let v=n.displayParts[n.displayParts.indexOf(s)-1];v&&(v.kind===\"localName\"||v.kind===\"parameterName\")&&(C=!0);}if(d.length>0){let s=d.map(v=>v.text).join(\"\").trim();console.log(`${c} Extracted type:`,s),s&&s!==\"any\"&&(S=s);}}return N.dispose(),S}catch(o){return console.warn(`${c} Type inference failed:`,o),null}}var De={fontSize:\"14px\",fontWeight:\"normal\",wordWrap:\"off\",lineNumbers:\"off\",lineNumbersMinChars:0,overviewRulerLanes:0,overviewRulerBorder:false,hideCursorInOverviewRuler:true,lineDecorationsWidth:0,glyphMargin:false,folding:false,scrollBeyondLastColumn:0,scrollbar:{horizontal:\"hidden\",vertical:\"hidden\",alwaysConsumeMouseWheel:false},find:{addExtraSpaceOnTop:false,autoFindInSelection:\"never\",seedSearchStringFromSelection:false},minimap:{enabled:false},wordBasedSuggestions:true,links:false,occurrencesHighlight:false,cursorStyle:\"line\",renderLineHighlight:\"none\",contextmenu:false,roundedSelection:false,hover:{delay:300},acceptSuggestionOnEnter:\"on\",automaticLayout:true,fixedOverflowWidgets:true,padding:{top:4,bottom:4},fontFamily:\"inherit\",letterSpacing:\"normal\",lineHeight:\"normal\"},Oe={fontSize:\"14px\",fontWeight:\"normal\",wordWrap:\"on\",lineNumbers:\"on\",lineNumbersMinChars:3,overviewRulerLanes:3,overviewRulerBorder:true,hideCursorInOverviewRuler:false,lineDecorationsWidth:10,glyphMargin:true,folding:true,scrollBeyondLastColumn:5,scrollbar:{horizontal:\"auto\",vertical:\"auto\",alwaysConsumeMouseWheel:false},find:{addExtraSpaceOnTop:false,autoFindInSelection:\"never\",seedSearchStringFromSelection:false},minimap:{enabled:true},wordBasedSuggestions:true,links:true,occurrencesHighlight:true,cursorStyle:\"line\",renderLineHighlight:\"line\",contextmenu:true,roundedSelection:true,hover:{delay:300},acceptSuggestionOnEnter:\"off\",automaticLayout:true,fixedOverflowWidgets:true,readOnly:false,domReadOnly:false};function je({value:u,onChange:i,onBlur:t,onEnter:c,onTypeInferred:o,onValidationChange:f,context:N={},className:m,placeholder:b=\"Enter expression...\"}){let y=useRef(null),e=useRef(null),n=useRef(null),S=s=>{e.current=s;let v=Object.keys(N);v.length>0&&s.languages.typescript.javascriptDefaults.addExtraLib(`\n        declare const ${v.join(\", \")}: any;\n      `,\"context.d.ts\");},C=(s,v)=>{y.current=s,s.updateOptions(De),console.log(\"\\u{1F537} Inline editor mounted!\");s.getDomNode();let L=s.addCommand(v.KeyMod.CtrlCmd|v.KeyCode.KEY_F,()=>{}),V=s.onKeyDown(l=>{if(l.keyCode===v.KeyCode.Enter){if(!s.hasTextFocus()){console.log(\"\\u{1F537} Enter keydown but inline editor does NOT have focus - allowing default\");return}if(l.shiftKey){console.log(\"\\u{1F537} Shift+Enter in INLINE editor - switching to full-screen\"),l.preventDefault(),l.stopPropagation(),c&&c();return}let x=s._contentWidgets?.[\"editor.widget.suggestWidget\"],E=x?.widget&&!x.widget._hidden&&x.widget.state!==void 0&&x.widget.state!==0,k=s._contextKeyService?.getContextKeyValue?.(\"suggestWidgetVisible\");E||k?(console.log(\"\\u{1F537} Enter in INLINE editor - accepting autocomplete\"),l.preventDefault(),l.stopPropagation(),s.trigger(\"\",\"acceptSelectedSuggestion\")):(console.log(\"\\u{1F537} Enter in INLINE editor - blurring (finishing edit)\"),l.preventDefault(),l.stopPropagation(),t?.({}));}});s.onDidPaste(l=>{if(l.endLineNumber<=1)return;let x=\"\",E=s.getModel(),w=E.getLineCount();for(let k=0;k<w;k+=1)x+=E.getLineContent(k+1);E.setValue(x),s.setPosition({column:x.length+1,lineNumber:1});}),s.onDidBlurEditorText(l=>{let x=s.getValue();t?.({...l,currentValue:x});}),s.onDidChangeModelContent(()=>{let l=s.getModel();if(l){if(f){let x=v.editor.getModelMarkers({resource:l.uri}),E=x.some(w=>w.severity===v.MarkerSeverity.Error);f(!E,x);}o&&(n.current&&clearTimeout(n.current),console.log(\"\\u{1F537} Content changed - debouncing type inference\"),n.current=setTimeout(async()=>{let x=l.getValue(),E=await q(s,v,x,\"\\u{1F537}\");E&&o(E);},200));}});let W=v.editor.onDidChangeMarkers(l=>{let x=s.getModel();if(!x||!o||!l.some(T=>T.toString()===x.uri.toString()))return;let k=v.editor.getModelMarkers({resource:x.uri}).some(T=>T.severity===v.MarkerSeverity.Error);console.log(\"\\u{1F537} Monaco markers changed - hasErrors:\",k),k?(n.current&&(clearTimeout(n.current),n.current=null),console.log(\"\\u{1F537} ERROR detected - immediately setting type to error\"),o(\"error\")):(n.current&&clearTimeout(n.current),console.log(\"\\u{1F537} Errors cleared - triggering type inference\"),n.current=setTimeout(async()=>{let T=x.getValue(),B=await q(s,v,T,\"\\u{1F537}\");B&&o(B);},100));});s.addCommand(v.KeyCode.F1,()=>{});let J=s.onDidChangeCursorPosition(async()=>{if(o&&s.hasTextFocus()){let l=s.getModel();if(l&&l.getValue().trim()){n.current&&clearTimeout(n.current);let x=l.getValue(),E=await q(s,v,x,\"\\u{1F537}\");E&&o(E);}}});s.setPosition({lineNumber:1,column:999999}),window.requestAnimationFrame(()=>{s.focus(),setTimeout(async()=>{let l=s.getModel();if(o&&l&&l.getValue())if(console.log(\"\\u{1F537} Triggering initial type inference for inline editor\"),v.editor.getModelMarkers({resource:l.uri}).some(w=>w.severity===v.MarkerSeverity.Error))o(\"error\");else {let w=l.getValue(),k=await q(s,v,w,\"\\u{1F537}\");k&&o(k);}},100);}),y.current._inlineDisposables={enterKeyDisposable:V,findCommand:L,markerChangeDisposable:W,cursorDisposable:J};};useEffect(()=>()=>{if(y.current){if(console.log(\"\\u{1F537} Inline editor unmounting - cleaning up\"),n.current&&clearTimeout(n.current),y.current._inlineDisposables){let s=y.current._inlineDisposables;s.enterKeyDisposable?.dispose?.(),s.findCommand?.dispose?.(),s.markerChangeDisposable?.dispose?.(),s.cursorDisposable?.dispose?.();}y.current=null;}},[]);let d=s=>{i(s||\"\");};return p__default.createElement(\"div\",{className:M(\"uii:relative uii:flex-1\",m)},p__default.createElement(Editor,{theme:\"vs-dark\",height:\"26px\",language:\"typescript\",value:u,onChange:d,onMount:C,beforeMount:S,width:\"100%\",loading:p__default.createElement(p__default.Fragment,null,p__default.createElement(FontAwesomeIcon,{icon:faSpinner,className:\"uii:animate-spin\"})),options:De,className:\"uii:-ml-[4px] uii:-mt-[1px] inline-editor\"}),!u&&p__default.createElement(\"div\",{className:\"uii:absolute uii:inset-0 uii:flex uii:items-center uii:pointer-events-none uii:text-muted-foreground uii:text-sm\"},b))}function Ke({value:u,onChange:i,onClose:t,onBlur:c,onTypeInferred:o,context:f={},className:N,placeholder:m=\"Enter expression...\"}){let b=useRef(null),y=useRef(null),e=useRef(null),n=d=>{y.current=d;let s=Object.keys(f);s.length>0&&d.languages.typescript.javascriptDefaults.addExtraLib(`\n        declare const ${s.join(\", \")}: any;\n      `,\"context.d.ts\");},S=(d,s)=>{b.current=d,d.updateOptions(Oe),console.log(\"\\u{1F7E6} FULL-SCREEN panel editor mounted!\"),console.log(\"Full-screen editor is read-only?\",d.getOption(s.editor.EditorOption.readOnly));let v=d.onKeyDown(l=>{if(l.keyCode===s.KeyCode.Escape&&(console.log(\"\\u{1F7E6} Escape pressed in FULL-SCREEN editor - closing\"),l.preventDefault(),l.stopPropagation(),t()),l.keyCode===s.KeyCode.Enter){let x=d._contentWidgets?.[\"editor.widget.suggestWidget\"],E=x?.widget&&!x.widget._hidden&&x.widget.state!==void 0&&x.widget.state!==0,k=d._contextKeyService?.getContextKeyValue?.(\"suggestWidgetVisible\");E||k?(console.log(\"\\u{1F7E6} Enter in FULL-SCREEN - accepting autocomplete\"),l.preventDefault(),l.stopPropagation(),d.trigger(\"\",\"acceptSelectedSuggestion\")):console.log(\"\\u{1F7E6} Enter in FULL-SCREEN - allowing newline (default behavior)\");}}),$=0,L=d.onDidChangeModelContent(l=>{$++;let x=d.getValue();console.log(`\\u{1F7E6} FULL-SCREEN content changed (${$}):`,x),console.log(`\\u{1F7E6} Line count: ${d.getModel()?.getLineCount()}`),o&&(e.current&&clearTimeout(e.current),console.log(\"\\u{1F7E6} Content changed - debouncing type inference\"),e.current=setTimeout(async()=>{let w=await q(d,s,x,\"\\u{1F7E6}\");w&&o(w);},200));}),V=s.editor.onDidChangeMarkers(l=>{let x=d.getModel();if(!x||!o||!l.some(T=>T.toString()===x.uri.toString()))return;let k=s.editor.getModelMarkers({resource:x.uri}).some(T=>T.severity===s.MarkerSeverity.Error);console.log(\"\\u{1F7E6} Monaco markers changed - hasErrors:\",k),k?(e.current&&(clearTimeout(e.current),e.current=null),console.log(\"\\u{1F7E6} ERROR detected - immediately setting type to error\"),o(\"error\")):(e.current&&clearTimeout(e.current),console.log(\"\\u{1F7E6} Errors cleared - triggering type inference\"),e.current=setTimeout(async()=>{let T=x.getValue(),B=await q(d,s,T,\"\\u{1F7E6}\");B&&o(B);},100));});d.onDidBlurEditorText(l=>{let x=d.getValue();c?.({...l,currentValue:x});});let W=d.getModel();if(W){let l=W.getLineCount(),x=W.getLineLength(l);d.setPosition({lineNumber:l,column:x+1});}d.focus(),setTimeout(async()=>{if(o&&W)if(console.log(\"\\u{1F7E6} Triggering initial type inference for full-screen editor\"),s.editor.getModelMarkers({resource:W.uri}).some(E=>E.severity===s.MarkerSeverity.Error))console.log(\"\\u{1F7E6} Initial load has error - setting type to error\"),o(\"error\");else {let E=W.getValue(),w=await q(d,s,E,\"\\u{1F7E6}\");w&&o(w);}},100);let J=d.onDidChangeCursorPosition(async()=>{if(o&&d.hasTextFocus()){let l=d.getModel();if(l&&l.getValue().trim()){e.current&&clearTimeout(e.current);let x=l.getValue(),E=await q(d,s,x,\"\\u{1F7E6}\");E&&o(E);}}});b.current._fullScreenDisposables={escapeKeyDisposable:v,changeDisposable:L,markerChangeDisposable:V,cursorDisposable:J};};useEffect(()=>()=>{if(b.current){if(console.log(\"\\u{1F7E6} Full-screen editor unmounting - cleaning up\"),e.current&&clearTimeout(e.current),b.current._fullScreenDisposables){let d=b.current._fullScreenDisposables;d.escapeKeyDisposable?.dispose?.(),d.changeDisposable?.dispose?.(),d.markerChangeDisposable?.dispose?.(),d.cursorDisposable?.dispose?.();}b.current=null;}},[]);let C=d=>{i(d||\"\");};return p__default.createElement(\"div\",{className:M(\"uii:relative uii:border uii:rounded-md uii:bg-background\",N)},p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:justify-between uii:p-2 uii:border-b uii:bg-muted/50\"},p__default.createElement(\"span\",{className:\"uii:text-sm uii:font-medium\"},\"Expression Editor\"),p__default.createElement(\"button\",{type:\"button\",onClick:t,className:\"uii:text-muted-foreground hover:uii:text-foreground uii:p-1 uii:rounded uii:cursor-pointer uii:text-xs\"},\"\\u2715\")),p__default.createElement(Editor,{height:\"300px\",theme:\"vs-dark\",language:\"typescript\",value:u,onChange:C,onMount:S,beforeMount:n,options:Oe}),!u&&p__default.createElement(\"div\",{className:\"uii:absolute uii:inset-0 uii:flex uii:items-center uii:justify-center uii:pointer-events-none uii:text-muted-foreground\"},m))}function _e(u,i){let[t,c]=useState(null),[o,f]=useState([]),[N,m]=useState([]),[b,y]=useState(false),[e,n]=useState(null),S=useRef(0),C=useRef(null),d=useRef(i||\"default\");return useEffect(()=>{d.current=i||\"default\";},[i]),useEffect(()=>{if(typeof window>\"u\"||!navigator.serviceWorker){n(\"Service worker not available\");return}let s=v=>{if(v.data.type===\"AST_PARSE_RESULT\"){let{id:$,controlKey:L,result:V}=v.data.payload;$===S.current&&L===d.current?(console.log(\"Service worker AST response:\",{id:$,controlKey:L,result:V}),c(V.ast),f(V.tokens),m(V.dependencies||[]),n(V.error||null),y(false)):console.log(\"Ignoring AST response - wrong control:\",{receivedId:$,expectedId:S.current,receivedKey:L,expectedKey:d.current});}};return C.current=s,navigator.serviceWorker.addEventListener(\"message\",s),()=>{C.current&&navigator.serviceWorker.removeEventListener(\"message\",C.current);}},[]),useEffect(()=>{if(!u.trim()){c(null),f([]),m([]),n(null),y(false);return}if(!navigator.serviceWorker||!navigator.serviceWorker.controller){n(\"Service worker not ready\"),y(false);return}y(true),n(null),S.current++,console.log(\"Sending expression to service worker:\",{expression:u.trim(),controlKey:d.current,id:S.current}),navigator.serviceWorker.controller.postMessage({type:\"PARSE_AST\",payload:{expression:u.trim(),id:S.current,controlKey:d.current}});},[u]),{ast:t,tokens:o,dependencies:N,isLoading:b,error:e}}function Ee({ast:u,key:i,className:t,variant:c=\"inline\",showTokens:o=false,tokens:f=[]}){let N=e=>{switch(e){case \"StringLiteral\":return \"uii:text-green-600 uii:bg-green-100\";case \"NumericLiteral\":return \"uii:text-purple-600 uii:bg-purple-100\";case \"Identifier\":return \"uii:text-blue-600 uii:bg-blue-100\";case \"Keyword\":case \"Literal\":return \"uii:text-orange-600 uii:bg-orange-100\";case \"BinaryExpression\":return \"uii:text-gray-700 uii:bg-gray-100\";case \"CallExpression\":return \"uii:text-indigo-600 uii:bg-indigo-100\";case \"MemberExpression\":return \"uii:text-cyan-600 uii:bg-cyan-100\";case \"UnaryExpression\":return \"uii:text-pink-600 uii:bg-pink-100\";case \"ParenthesizedExpression\":return \"uii:text-yellow-600 uii:bg-yellow-100\";default:return \"uii:text-gray-600 uii:bg-gray-100\"}},m=(e,n=0)=>n>2?null:e.type===\"Identifier\"?p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},p__default.createElement(\"span\",{className:\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-blue-100 uii:text-blue-800 uii:font-mono\"},e.name||e.value)):e.type===\"StringLiteral\"||e.type===\"NumericLiteral\"?p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},p__default.createElement(\"span\",{className:\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-green-100 uii:text-green-800 uii:font-mono\"},e.value)):e.type===\"BinaryExpression\"?p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},e.left&&m(e.left,n+1),p__default.createElement(\"span\",{className:\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-purple-100 uii:text-purple-800 uii:font-mono uii:mx-1\"},e.operator),e.right&&m(e.right,n+1)):e.type===\"CallExpression\"?p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},e.callee&&m(e.callee,n+1),p__default.createElement(\"span\",{className:\"text-xs text-gray-600\"},\"()\")):e.type===\"PropertyAccessExpression\"?p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},e.object&&m(e.object,n+1),p__default.createElement(\"span\",{className:\"text-xs text-gray-600\"},\".\"),e.property&&m(e.property,n+1)):p__default.createElement(\"span\",{key:`${e.start}-${e.end}`,className:\"uii:inline-flex uii:items-center uii:mr-1\"},p__default.createElement(\"span\",{className:\"px-1 py-0.5 rounded text-xs bg-gray-100 text-gray-600 font-mono\"},e.type)),b=(e,n=0)=>{if(n>4)return null;let S=\"  \".repeat(n);return p__default.createElement(\"div\",{key:`${e.start}-${e.end}`,className:\"font-mono text-xs\"},p__default.createElement(\"div\",{className:\"uii:flex uii:items-start uii:gap-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-400\"},S),p__default.createElement(\"span\",{className:M(\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:font-semibold\",N(e.type))},e.type),e.value&&p__default.createElement(\"span\",{className:\"uii:text-green-600\"},'\"',e.value,'\"'),e.operator&&p__default.createElement(\"span\",{className:\"uii:text-purple-600\"},e.operator),e.name&&p__default.createElement(\"span\",{className:\"uii:text-blue-600\"},e.name)),e.left&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"left: \"),b(e.left,n+1)),e.right&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"right: \"),b(e.right,n+1)),e.argument&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"arg: \"),b(e.argument,n+1)),e.object&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"obj: \"),b(e.object,n+1)),e.property&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"prop: \"),b(e.property,n+1)),e.index&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},p__default.createElement(\"span\",{className:\"uii:text-gray-500 uii:text-xs\"},\"idx: \"),b(e.index,n+1)),!e.left&&!e.right&&!e.argument&&!e.object&&!e.property&&!e.index&&e.children&&e.children.length>0&&p__default.createElement(\"div\",{className:\"uii:ml-2\"},e.children.slice(0,3).map((C,d)=>b(C,n+1)),e.children.length>3&&p__default.createElement(\"div\",{className:\"uii:ml-2 uii:text-gray-500 uii:text-xs\"},\"... and \",e.children.length-3,\" more\")))},y=()=>{if(f.length===0)return null;let e=f.slice(0,10);return p__default.createElement(\"div\",{className:\"uii:space-y-2\"},p__default.createElement(\"div\",{className:\"uii:text-sm uii:font-semibold uii:text-gray-700\"},\"Tokens \",f.length>10&&`(${f.length} total)`,\":\"),p__default.createElement(\"div\",{className:\"uii:flex uii:flex-wrap uii:gap-1\"},e.map((n,S)=>p__default.createElement(\"span\",{key:S,className:M(\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:font-mono\",n.type.includes(\"Keyword\")&&\"uii:bg-blue-100 uii:text-blue-800\",n.type.includes(\"Identifier\")&&\"uii:bg-green-100 uii:text-green-800\",n.type.includes(\"String\")&&\"uii:bg-yellow-100 uii:text-yellow-800\",n.type.includes(\"Numeric\")&&\"uii:bg-purple-100 uii:text-purple-800\",n.type.includes(\"Punctuation\")&&\"uii:bg-gray-100 uii:text-gray-800\",\"uii:bg-gray-100 uii:text-gray-600\")},n.value)),f.length>10&&p__default.createElement(\"span\",{className:\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-gray-200 uii:text-gray-600\"},\"+\",f.length-10,\" more\")))};return u?c===\"inline\"?p__default.createElement(\"div\",{className:M(\"uii:inline-flex uii:items-center uii:gap-2\",t)},m(u)):c===\"compact\"?p__default.createElement(\"div\",{className:M(\"uii:space-y-2\",t)},p__default.createElement(\"div\",{className:\"uii:flex uii:flex-wrap uii:gap-1\"},m(u)),o&&y()):p__default.createElement(\"div\",{className:M(\"uii:space-y-3\",t)},p__default.createElement(\"div\",{className:\"uii:space-y-2\"},p__default.createElement(\"div\",{className:\"uii:text-sm uii:font-semibold uii:text-gray-700\"},\"AST Tree:\"),p__default.createElement(\"div\",{className:\"uii:p-3 uii:border uii:rounded-md uii:bg-gray-50 uii:max-h-64 uii:overflow-auto\"},b(u))),o&&y()):p__default.createElement(\"div\",{className:M(\"uii:text-gray-500 uii:text-sm uii:italic\",t)},\"No AST available\")}function Be({label:u,value:i,type:t,valuesLoading:c=false,key:o,onValueChange:f,onDependenciesChange:N,metadata:m,children:b,fieldName:y,expressionContext:e={},availableNodes:n,myInterface:S,contextTypeDefinitions:C,inlineEditor:d=true,className:s,editorClassName:v,expressionPlaceholder:$=\"Enter expression...\",evaluateExpression:L,expressionResult:V,isEvaluating:W=false,isExpressionValid:J=true,expectedType:l=\"any\"}){let[x,E]=useState(()=>({...m||{expression:\"\",mode:\"value\",isEditing:false,isFullScreen:false,value:void 0},isEditing:false,isFullScreen:false,mode:\"value\"})),[w,k]=useState(i&&typeof i==\"object\"&&\"expression\"in i&&\"type\"in i&&i.type===\"expression\"?i.value:i),[T,B]=useState(i&&typeof i==\"object\"&&\"expression\"in i&&\"type\"in i&&i.type===\"expression\"?i.value:i),D=useCallback(a=>{switch(t){case \"float\":return typeof a==\"string\"&&!isNaN(parseFloat(a))?parseFloat(a):a;case \"integer\":case \"number\":return typeof a==\"string\"&&!isNaN(parseInt(a))?parseInt(a):a;case \"string[]\":return typeof a==\"string\"?a.split(\",\"):a;case \"string\":default:return a}},[t]),[vi,Qe]=useState(),Ze=le.getState().getState(y).expression;useEffect(()=>{m&&E({...m,isEditing:false,isFullScreen:false});},[m]);let Ye=useMemo(()=>i&&typeof i==\"object\"&&\"expression\"in i&&\"type\"in i&&i.type===\"expression\",[i]),ie=useRef(true);useEffect(()=>{if(i&&typeof i==\"object\"&&\"expression\"in i&&\"type\"in i&&i.type===\"expression\"){let a=i.value,h=i.expression;a!==void 0&&(B(D(a)),k(D(a))),h&&r.expression!==h&&(r.setExpression(h),ie.current&&!r.isEditing&&r.switchToExpression());let I=!m||m.expression!==h||m.mode===\"value\"||m.isEditing===true||m.isFullScreen===true;if(ie.current&&I){let F={expression:h||\"\",value:D(a),mode:\"expression\",isEditing:false,isFullScreen:false};setTimeout(()=>{f(i,{...F,value:D(i)});},0);}}else if(!c&&(B(D(i)),k(D(i)),ie.current&&(m?.expression||m?.mode===\"expression\"))){let a={expression:\"\",value:D(i),mode:\"value\",isEditing:false,isFullScreen:false};setTimeout(()=>{f(D(i),{...a,value:D(i)});},0);}ie.current&&setTimeout(()=>{ie.current=false;},100);},[i,c]);let r=Pe(y),{ast:Q,tokens:he,dependencies:z,isLoading:Se,error:G}=_e(r.expression,y),de=useMemo(()=>!Q||z.length===0?[]:z.map(a=>({name:a,exists:e?a in e:false,value:e?e[a]:void 0})),[z,e,Q]),[pe,Ge]=useState(null),Te=useCallback(a=>{Ge(a);},[]),H=useMemo(()=>r.expression.includes(`\n`)||r.expression.includes(\"\\r\"),[r.expression]),A=useMemo(()=>pe||\"unknown\",[pe]),se=useMemo(()=>{if(!A||A===\"unknown\"||A===\"any\"||A===\"error\")return  false;let a=A.toLowerCase().trim(),h=(t||l||\"any\").toLowerCase().trim();return !(h===\"array\"&&a.endsWith(\"[]\")||a===h||h===\"any\"||h===\"string\"&&(a.startsWith('\"')||a.startsWith(\"'\"))||h===\"number\"&&/^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(a)||h===\"integer\"&&/^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(a)||h===\"integer\"&&a===\"number\"||h===\"float\"&&/^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(a)||h===\"float\"&&a===\"number\"||h===\"boolean\"&&(a===\"true\"||a===\"false\"))},[A,t,l]),[ne,Ne]=useState(null),[Xe,we]=useState(false),[Re,ke]=useState(false),[ge,ei]=useState(true),[fe,ii]=useState({syntax:true,expression:true,context:true,type:true,security:true}),Me=useMemo(()=>!r.expression||!r.expression.trim()?false:!!(!ge||!J||G||!fe.syntax||!fe.expression||V?.error||ne?.error),[r.expression,ge,J,G,fe,V,ne]),oe=useRef(false),X=useRef(false),ae=useRef(false),ti=useCallback((a,h)=>{ei(a),ii(I=>({...I,syntax:a}));},[]),Ce=useCallback(a=>{let h=a.includes(`\n`),I=a.length>80;r.isFullScreen||r.setFullScreen(h||I);},[r.isFullScreen]),ri=useCallback(async(a,h)=>{if(!(!L||!a.trim())){we(true);try{let I=await L(a,h);Ne(I);}catch(I){Ne({value:null,ast:{kind:0,text:\"\",color:\"#ff0000\"},error:I instanceof Error?I.message:\"Unknown error\",isValid:false,validation:{syntax:false,expression:false,context:false,type:false,security:false}});}finally{we(false);}}},[L]),j=useMemo(()=>({expression:r.expression,value:T,mode:r.current,isEditing:r.isEditing,isFullScreen:r.isFullScreen}),[r.expression,r.current,r.isFullScreen,r.isEditing,T]),si=useMemo(()=>({expression:r.expression,type:\"expression\"}),[r.currentValue||r.expression]),Fe=useCallback(a=>{f(D(a),{...j,value:D(a)});},[f,r,Ye,T]),ue=useCallback(a=>{oe.current=false,r.setExpression(a),Qe(a),Ce(a),f({expression:a,type:\"expression\"},{...j,expression:a});},[r,e,f,L,ri,Ce]),xe=useCallback(async(a,h=false)=>{if(oe.current){oe.current=false;return}if(X.current){X.current=false;return}r.isFullScreen&&!h||H&&!h||(ae.current=true,r.setEditing(false),r.setFullScreen(false));},[r,V,ne,e,f,T,W,Xe,si,H]);useEffect(()=>{f(T,{...j,isFullScreen:r.isFullScreen});},[r.isFullScreen]),useEffect(()=>{r.isEditing&&H&&!r.isFullScreen&&r.setFullScreen(true);},[H,r.isEditing,r.isFullScreen]);let Z=useCallback(a=>{switch(a){case \"value\":r.switchToValue(),r.setFullScreen(false),f(w||i,void 0);break;case \"editor\":r.switchToEditor();let h=H;h&&r.setFullScreen(true);let I={expression:r.expression,value:T,mode:\"expression\",isEditing:true,isFullScreen:h};f(r.expression?{expression:r.expression,type:\"expression\"}:T,I);break;case \"expression\":k(T),r.switchToExpression(),H&&r.setFullScreen(true);break}},[r,T,f,H,w,i]);useEffect(()=>{ae.current&&(r.expression&&r.expression.trim()?f(j.mode===\"value\"?j.value??\"\":{expression:j.expression.trim(),type:\"expression\"},{...j,isEditing:false,isFullScreen:false}):(r.switchToValue(),f(j.value??\"\",{...j,mode:\"value\",expression:\"\",isEditing:false,isFullScreen:false})),ae.current=false);},[r.isEditing,r.isFullScreen,ae.current]),useEffect(()=>{N&&N(z);},[z,N]);let me=useCallback(()=>{oe.current=true,f(T,j),Z(\"value\"),r.setFullScreen(false);},[f,r,w]),[ni,Ae]=useState(T);useEffect(()=>{Ae(T);},[T]);let Ve=useMemo(()=>({value:T,onChange:Fe,onExpressionClick:()=>Z(\"editor\"),inferredType:A,hasTypeMismatch:se,hasError:Me,localInput:ni,setLocalInput:Ae,expressionMode:{current:r.current,switchToValue:()=>Z(\"value\"),switchToExpression:()=>Z(\"expression\"),switchToEditor:()=>Z(\"editor\"),clear:me,isExpressionMode:r.isExpressionMode,isEditorMode:r.isEditorMode,expression:r.expression,setExpression:ue,isEditing:r.isEditing,setEditing:r.setEditing,isFullScreen:r.isFullScreen,setFullScreen:r.setFullScreen}}),[T,Fe,r,Z,me,ue,A,se,Me]),oi=()=>{switch(r.current){case \"expression\":r.expression&&r.expression.trim();(V||ne)?.isValid;return Ve.expressionMode.isEditing?p__default.createElement(\"div\",{key:`${o}-expression`,className:M(\"relative\",s)},d&&!r.isFullScreen&&!H?p__default.createElement(\"div\",{className:M(`uii:flex uii:h-9 uii:w-full \n              uii:min-w-0 uii:rounded-sm \n              uii:border uii:border-ring \n              uii:bg-background uii:px-3 uii:py-1 uii:text-base uii:shadow-xs \n              uii:ring-ring/50 uii:ring-[3px] uii:transition-[color,box-shadow] \n              uii:outline-none uii:md:text-sm uii:cursor-pointer\n              uii:mt-0.5 `,v)},p__default.createElement(je,{value:r.expression,onChange:F=>{ue(F);},onEnter:()=>{X.current=true,r.setFullScreen(true),setTimeout(()=>{X.current=false;},100);},onBlur:xe,onTypeInferred:Te,onValidationChange:ti,context:e,placeholder:$}),p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:gap-2 uii:mt-0.5\"},p__default.createElement(\"span\",{className:\"uii:text-xs uii:font-mono uii:cursor-pointer uii:text-muted-foreground\",onMouseDown:F=>{F.preventDefault(),F.stopPropagation(),X.current=true,r.setFullScreen(true),setTimeout(()=>{X.current=false;},100);}},p__default.createElement(FontAwesomeIcon,{icon:faExpand})),p__default.createElement(\"span\",{className:\"uii:text-xs uii:font-mono uii:cursor-pointer uii:text-muted-foreground\",onMouseDown:F=>{F.preventDefault(),me();}},\"Clear\"))):p__default.createElement(\"div\",{className:\"uii:space-y-4\"},p__default.createElement(Ke,{value:r.expression,onChange:F=>{ue(F);},onClose:()=>{xe(void 0,true),r.setFullScreen(false);},onBlur:xe,onTypeInferred:Te,context:e,placeholder:$}),(Q||z.length>0)&&p__default.createElement(\"div\",{className:\"uii:space-y-3\"},A&&A!==\"unknown\"&&p__default.createElement(\"div\",{className:\"uii:space-y-2\"},p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:gap-2\"},p__default.createElement(\"div\",{className:\"uii:text-sm uii:font-semibold uii:text-gray-700\"},\"Inferred Return Type:\"),pe&&A!==\"error\"&&p__default.createElement(\"span\",{className:\"uii:px-1.5 uii:py-0.5 uii:text-xs uii:rounded uii:bg-blue-100 uii:text-blue-700 uii:border uii:border-blue-200\"},\"TypeScript\")),p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:gap-2\"},A===\"error\"?p__default.createElement(\"span\",{className:\"uii:px-3 uii:py-1.5 uii:text-sm uii:font-mono uii:rounded uii:border uii:bg-red-50 uii:text-red-800 uii:border-red-200\"},\"\\u274C Syntax Error\"):p__default.createElement(p__default.Fragment,null,p__default.createElement(\"span\",{className:\"uii:px-3 uii:py-1.5 uii:text-sm uii:font-mono uii:rounded uii:border uii:bg-purple-50 uii:text-purple-800 uii:border-purple-200\"},A),se&&p__default.createElement(\"span\",{className:\"uii:text-xs uii:text-orange-600 uii:font-semibold\"},\"\\u26A0\\uFE0F Expected: \",t||l)))),de.length>0&&p__default.createElement(\"div\",{className:\"uii:space-y-2\"},p__default.createElement(\"div\",{className:\"uii:text-sm uii:font-semibold uii:text-gray-700\"},\"Dependencies (\",de.length,\"):\"),p__default.createElement(\"div\",{className:\"uii:flex uii:flex-wrap uii:gap-2\"},de.map((F,ye)=>p__default.createElement(\"span\",{key:ye,className:M(\"uii:px-2 uii:py-1 uii:text-sm uii:rounded uii:border\",F.exists?\"uii:bg-blue-100 uii:text-blue-800 uii:border-blue-200\":\"uii:bg-red-100 uii:text-red-800 uii:border-red-200\"),title:F.exists?`Value: ${JSON.stringify(F.value)}`:\"Not found in context\"},F.name)))),Q&&p__default.createElement(Ee,{ast:Q,tokens:he,variant:\"tree\",showTokens:true,className:\"uii:w-full\"}),Se&&p__default.createElement(\"div\",{className:\"uii:text-sm uii:text-gray-500 uii:italic\"},\"Parsing expression...\"),G&&p__default.createElement(\"div\",{className:\"uii:text-sm uii:text-red-600\"},\"Parse Error: \",G)))):p__default.createElement(\"div\",{className:M(\"uii:relative\",s),key:`${o}-expression-display`},p__default.createElement(\"div\",{className:pi(\"uii:flex uii:h-9 uii:w-full uii:min-w-0 uii:rounded-sm uii:border uii:border-input uii:bg-transparent uii:px-3 uii:py-1 uii:text-base uii:shadow-xs uii:transition-[color,box-shadow] uii:outline-none uii:focus-visible:border-ring uii:focus-visible:ring-ring/50 uii:focus-visible:ring-[3px] uii:md:text-sm uii:cursor-pointer uii:hover:bg-muted/50\",\"uii:mt-0.5 uii:bg-white uii:rounded-md uii:items-center\"),onClick:()=>Z(\"editor\"),onMouseEnter:()=>ke(true),onMouseLeave:()=>ke(false)},p__default.createElement(\"span\",{className:\"uii:flex-1 uii:truncate uii:text-foreground uii:items-center\"},Re?p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:gap-2\"},Q?p__default.createElement(Ee,{key:`${o}-ast`,ast:Q,tokens:he,variant:\"inline\",showTokens:false,className:\"uii:text-xs\"}):p__default.createElement(\"div\",{className:\"uii:text-xs uii:text-gray-500\"},Se?\"Parsing...\":G?`Error: ${G}`:\"No AST available\"),z.length>0&&p__default.createElement(\"div\",{className:\"uii:flex uii:gap-1\"},z.map((F,ye)=>p__default.createElement(\"span\",{key:ye,className:\"uii:px-1 uii:py-0.5 uii:bg-blue-100 uii:text-blue-800 uii:text-xs uii:rounded\"},F)))):p__default.createElement(\"span\",{className:\"uii:font-mono uii:text-sm\"},Ze||\"No expression\"))));default:return b(Ve)}};return p__default.createElement(p__default.Fragment,null,p__default.createElement(\"div\",{className:\"uii:flex uii:items-center uii:gap-2 uii:mt-2\"},p__default.createElement(\"label\",{className:\"uii:text-xs uii:text-muted-foreground uii:font-bold\",htmlFor:o},u,\":\"),p__default.createElement(\"span\",{className:\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:text-muted-foreground uii:font-light\"},t),se||A===\"error\"?p__default.createElement(p__default.Fragment,null,r.current===\"expression\"?p__default.createElement(p__default.Fragment,null,p__default.createElement(\"span\",{className:\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:text-muted-foreground uii:font-light\"},r.expression.trim()!==\"\"?A:\"empty\"),p__default.createElement(\"span\",{className:\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:font-light uii:text-orange-600 \"},\"\\u26A0\\uFE0F Expected: \",t||l)):p__default.createElement(p__default.Fragment,null)):p__default.createElement(p__default.Fragment,null)),oi())}function ut({className:u,expectedType:i,...t}){let[c,o]=useState(t.value),[f,N]=useState({});return p.createElement(Be,{label:t.label??\"Test Entry\",key:t.name,type:i??\"string\",valuesLoading:false,value:t.value,onValueChange:(m,b)=>{o(m),b&&N(b);},expectedType:i,fieldName:t.name,children:({onExpressionClick:m,onChange:b,value:y,localInput:e,setLocalInput:n})=>p.createElement(\"div\",{className:\"uii:relative uii:text-xs uii:mt-0.5\"},p.createElement(Ie,{type:\"text\",value:e,onChange:S=>{n(S.target.value),b(S.target.value);},placeholder:t.placeholder??\"Enter value...\"}),p.createElement(\"div\",{className:\"uii:flex uii:bg-white uii:border-white/40 uii:border-l-8 uii:items-center uii:gap-1 uii:absolute uii:right-1.5 uii:top-2.5 uii:cursor-pointer uii:truncate\",onClick:()=>m()},p.createElement(\"span\",{className:\"uii:border-l uii:border-gray-200 uii:px-2\"},\"Custom Expression\")))})}var He=u=>typeof u==\"boolean\"?`${u}`:u===0?\"0\":u,Ue=clsx,qe=(u,i)=>t=>{var c;if(i?.variants==null)return Ue(u,t?.class,t?.className);let{variants:o,defaultVariants:f}=i,N=Object.keys(o).map(y=>{let e=t?.[y],n=f?.[y];if(e===null)return null;let S=He(e)||He(n);return o[y][S]}),m=t&&Object.entries(t).reduce((y,e)=>{let[n,S]=e;return S===void 0||(y[n]=S),y},{}),b=i==null||(c=i.compoundVariants)===null||c===void 0?void 0:c.reduce((y,e)=>{let{class:n,className:S,...C}=e;return Object.entries(C).every(d=>{let[s,v]=d;return Array.isArray(v)?v.includes({...f,...m}[s]):{...f,...m}[s]===v})?[...y,n,S]:y},[]);return Ue(u,N,b,t?.class,t?.className)};var yi=qe(\"ui:inline-flex ui:items-center ui:justify-center ui:gap-2 ui:whitespace-nowrap ui:rounded-sm ui:text-sm ui:font-medium ui:transition-[color,box-shadow] ui:disabled:pointer-events-none ui:disabled:opacity-50 ui:[&_svg]:pointer-events-none ui:[&_svg:not([class*=size-])]:size-4 ui:shrink-0 ui:[&_svg]:shrink-0 ui:outline-none ui:focus-visible:border-ring ui:focus-visible:ring-ring/50 ui:focus-visible:ring-[3px] ui:aria-invalid:ring-destructive/20 ui:dark:aria-invalid:ring-destructive/40 ui:aria-invalid:border-destructive ui:cursor-pointer\",{variants:{variant:{default:\"ui:bg-primary ui:text-primary-foreground ui:shadow-xs ui:hover:bg-primary/90 ui:select-none\",destructive:\"ui:bg-destructive ui:text-white ui:shadow-xs ui:hover:bg-destructive/90 ui:focus-visible:ring-destructive/20 ui:dark:focus-visible:ring-destructive/40\",outline:\"ui:border ui:border-input ui:bg-background ui:shadow-xs ui:hover:bg-accent ui:hover:text-accent-foreground\",secondary:\"ui:bg-secondary ui:text-secondary-foreground ui:shadow-xs ui:hover:bg-secondary/80\",ghost:\"ui:hover:bg-accent ui:hover:text-accent-foreground\",link:\"ui:text-primary ui:underline-offset-4 ui:hover:underline\"},size:{default:\"ui:h-9 ui:px-4 ui:py-2 ui:has-[>svg]:px-3\",sm:\"ui:h-8 ui:rounded-sm ui:gap-1.5 ui:px-3 ui:has-[>svg]:px-2.5\",lg:\"ui:h-10 ui:rounded-sm ui:px-6 ui:has-[>svg]:px-4\",icon:\"ui:size-9\"}},defaultVariants:{variant:\"default\",size:\"default\"}});function xt({className:u,variant:i,size:t,asChild:c=false,...o}){return p.createElement(c?Slot:\"button\",{\"data-slot\":\"button\",className:M(yi({variant:i,size:t,className:u})),...o})}export{xt as Button,ut as Input,yi as buttonVariants};//# sourceMappingURL=index.js.map\n","import { clsx, type ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/**\n * Returns the object if it is in the browser, otherwise returns an empty object.\n * This is useful for ensuring that the object is only used in the browser.\n * @param obj - The object to check.\n * @returns The object if it is in the browser, otherwise an empty object.\n */\nexport function useClient<T>(obj: T): T {\n  if (typeof globalThis.window === 'undefined') {\n    return {} as T;\n  }\n  return obj;\n}\n \n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n \n \n \n/**\n * ### Get the src of an image\n * #### Note: This should not be needed but importing `Images` is not consistent between various bundlers.\n * This function is used to get the src of an imported asset. It is used in the `Image` component.\n * @param image - The image to get the src of\n * @returns The src of the image\n * @example\n * getImageSrc('https://example.com/image.jpg') // 'https://example.com/image.jpg'\n * getImageSrc({ src: 'https://example.com/image.jpg' }) // 'https://example.com/image.jpg'\n * getImageSrc({ src: 'https://example.com/image.jpg', alt: 'Example Image' }) // 'https://example.com/image.jpg'\n *\n */\nexport function getImageSrc(image: string | { src: string } | any) {\n  if (typeof image === 'string') {\n    return image;\n  }\n  return image.src;\n}\n","import * as React from 'react';\n\nimport { cn } from '@/lib/utils';\n\nfunction Input({\n  className,\n  wrapperClassName,\n  type,\n  required,\n  error,\n  ...props\n}: React.ComponentProps<'input'> & { error?: boolean, wrapperClassName?: string }) {\n  return (\n    <div className={cn('uii:relative', wrapperClassName)}>\n      <input\n        aria-invalid={error}\n        type={type}\n        data-slot=\"input\"\n        className={cn(\n          'uii:border-input uii:file:text-foreground uii:placeholder:text-muted-foreground uii:selection:bg-primary uii:selection:text-primary-foreground uii:flex uii:h-9 uii:w-full uii:min-w-0 uii:rounded-sm uii:border uii:bg-transparent uii:px-3 uii:py-1 uii:text-base uii:shadow-xs uii:transition-[color,box-shadow] uii:outline-none uii:file:inline-flex uii:file:h-7 uii:file:border-0 uii:file:bg-transparent uii:file:text-sm uii:file:font-medium uii:disabled:pointer-events-none uii:disabled:cursor-not-allowed uii:disabled:opacity-50 uii:md:text-sm',\n          'uii:focus-visible:border-ring uii:focus-visible:ring-ring/50 uii:focus-visible:ring-[3px]',\n          'uii:aria-invalid:ring-destructive/20 uii:dark:aria-invalid:ring-destructive/40 uii:aria-invalid:border-destructive',\n          {\n            'uii:pr-30': error,\n          },\n          className,\n        )}\n        {...props}\n      />\n      {error && (\n        <span className=\"uii:absolute uii:inset-y-0 uii:right-0 uii:flex uii:items-center uii:pr-2 uii:border-l-10 uii:border-l-background uii:my-[6px] uii:pointer-events-none \">\n          <span className=\"uii:bg-destructive uii:text-white uii:px-1.5 uii:py-1.5 uii:rounded-xs uii:uppercase uii:tracking-wide uii:font-medium uii:text-xs uii:leading-none uii:font-sans\">\n            {error && required ? 'required' : 'error'}\n          </span>\n        </span>\n      )}\n    </div>\n  );\n}\n\nexport { Input };\n","import { create } from 'zustand';\nimport { ExpressionModeState } from '../hooks/useExpressionMode';\n\ninterface ExpressionModeStore {\n  // Store state by field name\n  states: Record<string, ExpressionModeState>;\n\n  // Actions\n  setState: (fieldName: string, state: ExpressionModeState) => void;\n  getState: (fieldName: string) => ExpressionModeState;\n  clear: (fieldName: string) => void;\n\n  // Helper actions\n  switchToValue: (fieldName: string) => void;\n  switchToExpression: (fieldName: string) => void;\n  switchToEditor: (fieldName: string) => void;\n  setExpression: (fieldName: string, expression: string) => void;\n  setEditing: (fieldName: string, isEditing: boolean) => void;\n  setCurrentValue: (fieldName: string, value: any) => void;\n  setFullScreen: (fieldName: string, isFullScreen: boolean) => void;\n}\n\nconst defaultState: ExpressionModeState = {\n  expression: '',\n  mode: 'value',\n  isEditing: false,\n  currentValue: undefined,\n  isFullScreen: false\n};\n\nexport const useExpressionModeStore = create<ExpressionModeStore>((set, get) => ({\n  states: {},\n\n  setState: (fieldName: string, state: ExpressionModeState) => {\n    set((store) => ({\n      states: {\n        ...store.states,\n        [fieldName]: state\n      }\n    }));\n  },\n\n  getState: (fieldName: string) => {\n    const store = get();\n    return store.states[fieldName] || defaultState;\n  },\n\n  clear: (fieldName: string) => {\n    set((store) => ({\n      states: {\n        ...store.states,\n        [fieldName]: defaultState\n      }\n    }));\n  },\n\n  switchToValue: (fieldName: string) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      mode: 'value',\n      isEditing: false\n    });\n  },\n\n  switchToExpression: (fieldName: string) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      mode: 'expression',\n      isEditing: false\n    });\n  },\n\n  switchToEditor: (fieldName: string) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      mode: 'expression',\n      isEditing: true\n    });\n  },\n\n  setExpression: (fieldName: string, expression: string) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      expression\n    });\n  },\n\n  setEditing: (fieldName: string, isEditing: boolean) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      isEditing\n    });\n  },\n  setFullScreen: (fieldName: string, isFullScreen: boolean) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      isFullScreen\n    });\n  },\n  setCurrentValue: (fieldName: string, value: any) => {\n    const currentState = get().getState(fieldName);\n    get().setState(fieldName, {\n      ...currentState,\n      currentValue: value\n    });\n  }\n}));\n","import { useCallback } from 'react';\nimport { useExpressionModeStore } from '../stores/expressionModeStore';\n\nexport interface ExpressionModeState {\n  expression: string;\n  mode: 'value' | 'expression';\n  isEditing: boolean;\n  isFullScreen: boolean;\n  currentValue?: any;\n}\n\nexport interface ExpressionModeControls {\n  current: 'value' | 'expression';\n  switchToValue: () => void;\n  switchToExpression: () => void;\n  switchToEditor: () => void;\n  clear: () => void;\n  isExpressionMode: boolean;\n  isEditorMode: boolean;\n  expression: string;\n  setExpression: (expr: string) => void;\n  isEditing: boolean;\n  setEditing: (editing: boolean) => void;\n  currentValue?: any;\n  isFullScreen: boolean;\n  setFullScreen: (isFullScreen: boolean) => void;\n  setCurrentValue: (value: any) => void;\n\n  localInput: string,\n\n  setLocalInput: (value: any) => void;\n}\n\n/**\n * Hook for managing expression mode state using Zustand store\n * @param fieldName - Unique identifier for the field\n * @returns Expression mode controls and state\n */\nexport function useExpressionMode(fieldName: string): Omit<ExpressionModeControls, \"localInput\" | \"setLocalInput\"> {\n  const store = useExpressionModeStore();\n  const state = store.getState(fieldName);\n\n  const switchToValue = useCallback(() => {\n    store.switchToValue(fieldName);\n  }, [store, fieldName]);\n\n  const switchToExpression = useCallback(() => {\n    store.switchToExpression(fieldName);\n  }, [store, fieldName]);\n\n  const switchToEditor = useCallback(() => {\n    store.switchToEditor(fieldName);\n  }, [store, fieldName]);\n\n  const clear = useCallback(() => {\n    store.clear(fieldName);\n  }, [store, fieldName]);\n\n  const setExpression = useCallback((expr: string) => {\n    store.setExpression(fieldName, expr);\n  }, [store, fieldName]);\n\n  const setEditing = useCallback((editing: boolean) => {\n    store.setEditing(fieldName, editing);\n  }, [store, fieldName]);\n\n  const setCurrentValue = useCallback((value: any) => {\n    store.setCurrentValue(fieldName, value);\n  }, [store, fieldName]);\n\n  const setFullScreen = useCallback((isFullScreen: boolean) => {\n    store.setFullScreen(fieldName, isFullScreen);\n  }, [store, fieldName]);\n\n  return {\n    current: state.mode,\n    switchToValue,\n    switchToExpression,\n    switchToEditor,\n    clear,\n    isExpressionMode: state.mode === 'expression',\n    isEditorMode: state.isEditing,\n    expression: state.expression,\n    setExpression,\n    isEditing: state.isEditing,\n    setEditing,\n    currentValue: state.currentValue,\n    setCurrentValue,\n    isFullScreen: state.isFullScreen,\n    setFullScreen,\n  };\n}\n","import React, { useRef, useEffect, useCallback } from 'react';\nimport { Editor } from '@monaco-editor/react';\nimport { cn } from '@/lib/utils';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSpinner } from '@fortawesome/pro-regular-svg-icons';\n\nexport interface ExpressionContext {\n  [key: string]: any;\n}\n\nexport interface InlineExpressionEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  onBlur?: (e: any) => void;\n  onEnter?: () => void; // Called when Enter is pressed (to switch to full-screen)\n  onTypeInferred?: (type: string) => void; // Callback when TypeScript infers the type\n  onValidationChange?: (isValid: boolean, errors: any[]) => void;\n  context?: ExpressionContext;\n  className?: string;\n  placeholder?: string;\n}\n\nexport interface FullPanelExpressionEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  onClose: () => void;\n  onBlur?: (e: any) => void;\n  onTypeInferred?: (type: string) => void; // Callback when TypeScript infers the type\n  context?: ExpressionContext;\n  className?: string;\n  placeholder?: string;\n}\n\n/**\n * Shared function to infer TypeScript type from an expression\n * Used by both inline and full-screen editors\n * Returns 'error' if there are Monaco validation errors\n */\nasync function inferTypeFromMonaco(\n  editor: any,\n  monaco: any,\n  expression: string,\n  logPrefix: string = '🔷'\n): Promise<string | null> {\n  if (!expression.trim()) {\n    console.log(`${logPrefix} Type inference skipped - no expression`);\n    return null;\n  }\n  \n  // Only infer type if THIS editor has focus\n  if (!editor.hasTextFocus()) {\n    console.log(`${logPrefix} Skipping type inference - editor does not have focus`);\n    return null;\n  }\n\n  console.log(`${logPrefix} Running type inference, expression:`, expression);\n\n  try {\n    // Check for Monaco validation errors first\n    const currentModel = editor.getModel();\n    if (currentModel) {\n      const markers = monaco.editor.getModelMarkers({ resource: currentModel.uri });\n      const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n      \n      if (hasErrors) {\n        console.log(`${logPrefix} Type inference skipped - expression has validation errors`);\n        return 'error';\n      }\n    }\n\n    // Create a temporary model with the expression wrapped\n    // This allows TypeScript to infer the type properly\n    const wrappedCode = `const __expr__ = (${expression});`;\n    const tempModel = monaco.editor.createModel(wrappedCode, 'typescript');\n    \n    // Get TypeScript worker\n    const worker = await monaco.languages.typescript.getTypeScriptWorker();\n    const client = await worker(tempModel.uri);\n\n    // Find position of __expr__ variable\n    const exprIndex = wrappedCode.indexOf('__expr__');\n    const position = tempModel.getPositionAt(exprIndex);\n\n    const quickInfo = await client.getQuickInfoAtPosition(\n      tempModel.uri.toString(),\n      tempModel.getOffsetAt(position)\n    );\n\n    console.log(`${logPrefix} QuickInfo response:`, quickInfo);\n\n    let extractedType: string | null = null;\n\n    if (quickInfo && quickInfo.displayParts) {\n      // Extract type from displayParts\n      let foundColon = false;\n      const typeParts: any[] = [];\n      \n      for (const part of quickInfo.displayParts) {\n        if (foundColon) typeParts.push(part);\n        if (part.kind === 'punctuation' && part.text === ':' && !foundColon) {\n          const prevPart = quickInfo.displayParts[quickInfo.displayParts.indexOf(part) - 1];\n          if (prevPart && (prevPart.kind === 'localName' || prevPart.kind === 'parameterName')) {\n            foundColon = true;\n          }\n        }\n      }\n\n      if (typeParts.length > 0) {\n        const typeString = typeParts.map((p: any) => p.text).join('').trim();\n        console.log(`${logPrefix} Extracted type:`, typeString);\n        if (typeString && typeString !== 'any') {\n          extractedType = typeString;\n        }\n      }\n    }\n    \n    // Clean up temporary model\n    tempModel.dispose();\n    return extractedType;\n  } catch (error) {\n    console.warn(`${logPrefix} Type inference failed:`, error);\n    return null;\n  }\n}\n\n// Monaco options to match Input component styling\nconst InlineEditorOptions = {\n  fontSize: '14px', // md:text-sm\n  fontWeight: 'normal',\n  wordWrap: 'off',\n  lineNumbers: 'off',\n  lineNumbersMinChars: 0,\n  overviewRulerLanes: 0,\n  overviewRulerBorder: false,\n  hideCursorInOverviewRuler: true,\n  lineDecorationsWidth: 0,\n  glyphMargin: false,\n  folding: false,\n  scrollBeyondLastColumn: 0,\n  scrollbar: {\n    horizontal: 'hidden',\n    vertical: 'hidden',\n    alwaysConsumeMouseWheel: false,\n  },\n  find: {\n    addExtraSpaceOnTop: false,\n    autoFindInSelection: 'never',\n    seedSearchStringFromSelection: false,\n  },\n  minimap: { enabled: false },\n  wordBasedSuggestions: true, // Enable for better UX\n  links: false,\n  occurrencesHighlight: false,\n  cursorStyle: 'line', // Match input cursor\n  renderLineHighlight: 'none',\n  contextmenu: false,\n  roundedSelection: false,\n  hover: {\n    delay: 300,\n  },\n  acceptSuggestionOnEnter: 'on',\n  automaticLayout: true,\n  fixedOverflowWidgets: true,\n  // Match Input component styling\n  padding: { top: 4, bottom: 4 }, // py-1 equivalent\n  fontFamily: 'inherit', // Use system font\n  letterSpacing: 'normal',\n  lineHeight: 'normal',\n} as any;\n\nconst FullPanelEditorOptions = {\n  fontSize: '14px',\n  fontWeight: 'normal',\n  wordWrap: 'on',\n  lineNumbers: 'on',\n  lineNumbersMinChars: 3,\n  overviewRulerLanes: 3,\n  overviewRulerBorder: true,\n  hideCursorInOverviewRuler: false,\n  lineDecorationsWidth: 10,\n  glyphMargin: true,\n  folding: true,\n  scrollBeyondLastColumn: 5,\n  scrollbar: {\n    horizontal: 'auto',\n    vertical: 'auto',\n    alwaysConsumeMouseWheel: false,\n  },\n  find: {\n    addExtraSpaceOnTop: false,\n    autoFindInSelection: 'never',\n    seedSearchStringFromSelection: false,\n  },\n  minimap: { enabled: true },\n  wordBasedSuggestions: true,\n  links: true,\n  occurrencesHighlight: true,\n  cursorStyle: 'line',\n  renderLineHighlight: 'line',\n  contextmenu: true,\n  roundedSelection: true,\n  hover: {\n    delay: 300,\n  },\n  // IMPORTANT: Don't accept suggestions on Enter - let Enter create new lines\n  acceptSuggestionOnEnter: 'off',\n  automaticLayout: true,\n  fixedOverflowWidgets: true,\n  readOnly: false,  // Explicitly allow editing\n  domReadOnly: false, // Allow DOM manipulation\n} as any;\n\n/**\n * Inline Monaco editor for expressions - based on your SingleLineEditor\n */\nexport function InlineExpressionEditor({\n  value,\n  onChange,\n  onBlur,\n  onEnter,\n  onTypeInferred,\n  onValidationChange,\n  context = {},\n  className,\n  placeholder = 'Enter expression...',\n}: InlineExpressionEditorProps) {\n  const editorRef = useRef<any>(null);\n  const monacoRef = useRef<any>(null);\n  const typeInferenceTimeoutRef = useRef<any>(null);\n\n  const handleEditorWillMount = (monaco: any) => {\n    monacoRef.current = monaco;\n\n    // Add context variables to completion\n    const contextKeys = Object.keys(context);\n    if (contextKeys.length > 0) {\n      monaco.languages.typescript.javascriptDefaults.addExtraLib(`\n        declare const ${contextKeys.join(', ')}: any;\n      `, 'context.d.ts');\n    }\n  };\n\n  const handleEditorDidMount = (editor: any, monaco: any) => {\n    editorRef.current = editor;\n\n    // Apply your proven configuration\n    editor.updateOptions(InlineEditorOptions);\n\n    console.log('🔷 Inline editor mounted!');\n\n    // Use CSS filter to invert colors for inline editor (light theme effect)\n    const editorElement = editor.getDomNode();\n    // if (editorElement) {\n    //   // editorElement.style = editorElement.style + \" background-color: #1e1e1e !important;\";\n    //   // editorElement.style.filter = 'invert(1) hue-rotate(180deg)';\n    // }\n\n    // Disable Find widget\n    const findCommand = editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KEY_F, () => { });\n\n    // Handle Enter and Shift+Enter using onKeyDown\n    const enterKeyDisposable = editor.onKeyDown((e: any) => {\n      if (e.keyCode === monaco.KeyCode.Enter) {\n        // Only handle if THIS editor has focus\n        if (!editor.hasTextFocus()) {\n          console.log('🔷 Enter keydown but inline editor does NOT have focus - allowing default');\n          return;\n        }\n        \n        // Check if Shift is pressed (Shift+Enter)\n        if (e.shiftKey) {\n          console.log('🔷 Shift+Enter in INLINE editor - switching to full-screen');\n          e.preventDefault();\n          e.stopPropagation();\n          // Switch to full-screen for multi-line editing\n          if (onEnter) {\n            onEnter();\n          }\n          return;\n        }\n        \n        // Regular Enter (no Shift)\n        // Check if autocomplete is visible\n        const suggestWidget = editor._contentWidgets?.['editor.widget.suggestWidget'];\n        const isSuggestVisible = \n          suggestWidget?.widget &&\n          !suggestWidget.widget._hidden &&\n          suggestWidget.widget.state !== undefined &&\n          suggestWidget.widget.state !== 0;\n        \n        const contextKeyService = editor._contextKeyService;\n        const suggestWidgetVisible = contextKeyService?.getContextKeyValue?.('suggestWidgetVisible');\n        \n        if (isSuggestVisible || suggestWidgetVisible) {\n          console.log('🔷 Enter in INLINE editor - accepting autocomplete');\n          e.preventDefault();\n          e.stopPropagation();\n        editor.trigger('', 'acceptSelectedSuggestion');\n      } else {\n          console.log('🔷 Enter in INLINE editor - blurring (finishing edit)');\n          e.preventDefault();\n          e.stopPropagation();\n          // Blur to finish editing\n        onBlur?.({});\n        }\n      }\n    });\n\n    // Handle paste - remove line breaks (like your implementation)\n    editor.onDidPaste((e: any) => {\n      if (e.endLineNumber <= 1) {\n        return;\n      }\n      let newContent = '';\n      const textModel = editor.getModel();\n      const lineCount = textModel.getLineCount();\n      for (let i = 0; i < lineCount; i += 1) {\n        newContent += textModel.getLineContent(i + 1);\n      }\n      textModel.setValue(newContent);\n      editor.setPosition({ column: newContent.length + 1, lineNumber: 1 });\n    });\n\n    // Handle blur - switch to expression mode when editor loses focus\n    editor.onDidBlurEditorText((e: any) => {\n      const currentValue = editor.getValue();\n      onBlur?.({ ...e, currentValue });\n    });\n\n    // Track validation errors on content change\n      editor.onDidChangeModelContent(() => {\n        const model = editor.getModel();\n        if (model) {\n        // Validation\n        if (onValidationChange) {\n          const markers = monaco.editor.getModelMarkers({ resource: model.uri });\n          const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n          onValidationChange(!hasErrors, markers);\n        }\n        \n        // Debounce type inference - will be cancelled if errors appear via marker change listener\n        if (onTypeInferred) {\n          if (typeInferenceTimeoutRef.current) {\n            clearTimeout(typeInferenceTimeoutRef.current);\n          }\n          \n          console.log('🔷 Content changed - debouncing type inference');\n          typeInferenceTimeoutRef.current = setTimeout(async () => {\n            const expressionToAnalyze = model.getValue();\n            const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🔷');\n            if (inferredType) {\n              onTypeInferred(inferredType);\n            }\n          }, 200); // Reduced from 500ms to 200ms for better responsiveness\n        }\n      }\n    });\n    \n    // Listen to MONACO'S marker changes - fires when TypeScript detects errors\n    const markerChangeDisposable = monaco.editor.onDidChangeMarkers((uris: any[]) => {\n      const model = editor.getModel();\n      if (!model || !onTypeInferred) return;\n      \n      // Check if this marker change is for our model\n      const isOurModel = uris.some((uri: any) => uri.toString() === model.uri.toString());\n      if (!isOurModel) return;\n      \n      const markers = monaco.editor.getModelMarkers({ resource: model.uri });\n      const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n      \n      console.log('🔷 Monaco markers changed - hasErrors:', hasErrors);\n      \n      if (hasErrors) {\n        // Cancel any pending type inference and immediately set to error\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n          typeInferenceTimeoutRef.current = null;\n        }\n        console.log('🔷 ERROR detected - immediately setting type to error');\n        onTypeInferred('error');\n      } else {\n        // Errors cleared - trigger type inference\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n        }\n        console.log('🔷 Errors cleared - triggering type inference');\n        typeInferenceTimeoutRef.current = setTimeout(async () => {\n          const expressionToAnalyze = model.getValue();\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🔷');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }, 100); // Shorter delay when recovering from error\n      }\n    });\n\n    // Disable F1 command palette\n    editor.addCommand(monaco.KeyCode.F1, () => { });\n\n    // Add immediate type inference on cursor movement (for better responsiveness)\n    const cursorDisposable = editor.onDidChangeCursorPosition(async () => {\n      if (onTypeInferred && editor.hasTextFocus()) {\n        const model = editor.getModel();\n        if (model && model.getValue().trim()) {\n          // Clear any pending debounced inference\n          if (typeInferenceTimeoutRef.current) {\n            clearTimeout(typeInferenceTimeoutRef.current);\n          }\n          \n          // Immediate type inference on cursor movement\n          const expressionToAnalyze = model.getValue();\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🔷');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }\n      }\n    });\n\n    // Set cursor to end and focus\n    editor.setPosition({\n      lineNumber: 1,\n      column: 999999,\n    });\n\n    window.requestAnimationFrame(() => {\n      editor.focus();\n      \n      // Trigger initial type inference after editor settles\n      setTimeout(async () => {\n        const model = editor.getModel();\n        if (onTypeInferred && model && model.getValue()) {\n          console.log('🔷 Triggering initial type inference for inline editor');\n          \n          // Check for errors first\n          const markers = monaco.editor.getModelMarkers({ resource: model.uri });\n          const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n          \n          if (hasErrors) {\n            onTypeInferred('error');\n          } else {\n            const expressionToAnalyze = model.getValue();\n            const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🔷');\n            if (inferredType) {\n              onTypeInferred(inferredType);\n            }\n          }\n        }\n      }, 100);\n    });\n\n    // Store disposables for cleanup\n    editorRef.current._inlineDisposables = {\n      enterKeyDisposable,\n      findCommand,\n      markerChangeDisposable,\n      cursorDisposable\n    };\n  };\n\n  // Cleanup when unmounting\n  useEffect(() => {\n    return () => {\n      if (editorRef.current) {\n        console.log('🔷 Inline editor unmounting - cleaning up');\n        // Clear type inference timeout\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n        }\n        // Dispose of event listeners\n        if (editorRef.current._inlineDisposables) {\n          const disposables = editorRef.current._inlineDisposables;\n          disposables.enterKeyDisposable?.dispose?.();\n          disposables.findCommand?.dispose?.();\n          disposables.markerChangeDisposable?.dispose?.();\n          disposables.cursorDisposable?.dispose?.();\n        }\n        editorRef.current = null;\n      }\n    };\n  }, []);\n\n  const handleEditorChange = (newValue: string | undefined) => {\n    onChange(newValue || '');\n  };\n\n  return (\n    <div className={cn(\"uii:relative uii:flex-1\", className)}>\n      <Editor\n        theme=\"vs-dark\"\n        height=\"26px\"\n        language=\"typescript\"\n        value={value}\n        onChange={handleEditorChange}\n        onMount={handleEditorDidMount}\n        beforeMount={handleEditorWillMount}\n        width=\"100%\"\n        loading={<><FontAwesomeIcon icon={faSpinner} className=\"uii:animate-spin\" /></>}\n        options={InlineEditorOptions}\n        className=\"uii:-ml-[4px] uii:-mt-[1px] inline-editor\"\n      />\n      {!value && (\n        <div className=\"uii:absolute uii:inset-0 uii:flex uii:items-center uii:pointer-events-none uii:text-muted-foreground uii:text-sm\">\n          {placeholder}\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Full panel Monaco editor for expressions\n */\nexport function FullPanelExpressionEditor({\n  value,\n  onChange,\n  onClose,\n  onBlur,\n  onTypeInferred,\n  context = {},\n  className,\n  placeholder = 'Enter expression...',\n}: FullPanelExpressionEditorProps) {\n  const editorRef = useRef<any>(null);\n  const monacoRef = useRef<any>(null);\n  const typeInferenceTimeoutRef = useRef<any>(null);\n\n  const handleEditorWillMount = (monaco: any) => {\n    monacoRef.current = monaco;\n\n    // Add context variables to completion\n    const contextKeys = Object.keys(context);\n    if (contextKeys.length > 0) {\n      monaco.languages.typescript.javascriptDefaults.addExtraLib(`\n        declare const ${contextKeys.join(', ')}: any;\n      `, 'context.d.ts');\n    }\n  };\n\n  const handleFPEditorDidMount = (editor: any, monaco: any) => {\n    editorRef.current = editor;\n\n    // Apply full panel configuration\n    editor.updateOptions(FullPanelEditorOptions);\n\n    console.log('🟦 FULL-SCREEN panel editor mounted!');\n    console.log('Full-screen editor is read-only?', editor.getOption(monaco.editor.EditorOption.readOnly));\n\n    // Handle Escape and Enter with onKeyDown\n    const escapeKeyDisposable = editor.onKeyDown((e: any) => {\n      if (e.keyCode === monaco.KeyCode.Escape) {\n        console.log('🟦 Escape pressed in FULL-SCREEN editor - closing');\n        e.preventDefault();\n        e.stopPropagation();\n      onClose();\n      }\n      \n      // Handle Enter key - check for autocomplete first\n      if (e.keyCode === monaco.KeyCode.Enter) {\n        // Check if suggestion widget is visible\n        const suggestWidget = editor._contentWidgets?.['editor.widget.suggestWidget'];\n        const isSuggestVisible = \n          suggestWidget?.widget &&\n          !suggestWidget.widget._hidden &&\n          suggestWidget.widget.state !== undefined &&\n          suggestWidget.widget.state !== 0;\n        \n        const contextKeyService = editor._contextKeyService;\n        const suggestWidgetVisible = contextKeyService?.getContextKeyValue?.('suggestWidgetVisible');\n        \n        if (isSuggestVisible || suggestWidgetVisible) {\n          console.log('🟦 Enter in FULL-SCREEN - accepting autocomplete');\n          e.preventDefault();\n          e.stopPropagation();\n          editor.trigger('', 'acceptSelectedSuggestion');\n        } else {\n          console.log('🟦 Enter in FULL-SCREEN - allowing newline (default behavior)');\n          // Don't prevent default - let Monaco insert newline\n        }\n      }\n    });\n\n    // Track content changes\n    let changeCount = 0;\n    const changeDisposable = editor.onDidChangeModelContent((e: any) => {\n      changeCount++;\n      const newValue = editor.getValue();\n      console.log(`🟦 FULL-SCREEN content changed (${changeCount}):`, newValue);\n      console.log(`🟦 Line count: ${editor.getModel()?.getLineCount()}`);\n      \n      // Debounce type inference - will be cancelled if errors appear via marker change listener\n      if (onTypeInferred) {\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n        }\n        \n        console.log('🟦 Content changed - debouncing type inference');\n        typeInferenceTimeoutRef.current = setTimeout(async () => {\n          const expressionToAnalyze = newValue;\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🟦');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }, 200); // Reduced from 500ms to 200ms for better responsiveness\n      }\n    });\n    \n    // Listen to MONACO'S marker changes - fires when TypeScript detects errors\n    const markerChangeDisposable = monaco.editor.onDidChangeMarkers((uris: any[]) => {\n      const model = editor.getModel();\n      if (!model || !onTypeInferred) return;\n      \n      // Check if this marker change is for our model\n      const isOurModel = uris.some((uri: any) => uri.toString() === model.uri.toString());\n      if (!isOurModel) return;\n      \n      const markers = monaco.editor.getModelMarkers({ resource: model.uri });\n      const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n      \n      console.log('🟦 Monaco markers changed - hasErrors:', hasErrors);\n      \n      if (hasErrors) {\n        // Cancel any pending type inference and immediately set to error\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n          typeInferenceTimeoutRef.current = null;\n        }\n        console.log('🟦 ERROR detected - immediately setting type to error');\n        onTypeInferred('error');\n      } else {\n        // Errors cleared - trigger type inference\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n        }\n        console.log('🟦 Errors cleared - triggering type inference');\n        typeInferenceTimeoutRef.current = setTimeout(async () => {\n          const expressionToAnalyze = model.getValue();\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🟦');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }, 100); // Shorter delay when recovering from error\n      }\n    });\n\n    // Handle blur - switch to expression mode when editor loses focus\n    editor.onDidBlurEditorText((e: any) => {\n      const currentValue = editor.getValue();\n      onBlur?.({ ...e, currentValue });\n    });\n\n    // Focus the editor and position cursor at the end\n    const model = editor.getModel();\n    if (model) {\n      const lineCount = model.getLineCount();\n      const lastLineLength = model.getLineLength(lineCount);\n      editor.setPosition({ lineNumber: lineCount, column: lastLineLength + 1 });\n    }\n    editor.focus();\n\n    // Trigger initial type inference after a short delay (let editor settle)\n    setTimeout(async () => {\n      if (onTypeInferred && model) {\n        console.log('🟦 Triggering initial type inference for full-screen editor');\n        \n        // Check for errors first\n        const markers = monaco.editor.getModelMarkers({ resource: model.uri });\n        const hasErrors = markers.some((marker: any) => marker.severity === monaco.MarkerSeverity.Error);\n        \n        if (hasErrors) {\n          console.log('🟦 Initial load has error - setting type to error');\n          onTypeInferred('error');\n        } else {\n          const expressionToAnalyze = model.getValue();\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🟦');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }\n      }\n    }, 100);\n\n    // Add immediate type inference on cursor movement (for better responsiveness)\n    const cursorDisposable = editor.onDidChangeCursorPosition(async () => {\n      if (onTypeInferred && editor.hasTextFocus()) {\n        const model = editor.getModel();\n        if (model && model.getValue().trim()) {\n          // Clear any pending debounced inference\n          if (typeInferenceTimeoutRef.current) {\n            clearTimeout(typeInferenceTimeoutRef.current);\n          }\n          \n          // Immediate type inference on cursor movement\n          const expressionToAnalyze = model.getValue();\n          const inferredType = await inferTypeFromMonaco(editor, monaco, expressionToAnalyze, '🟦');\n          if (inferredType) {\n            onTypeInferred(inferredType);\n          }\n        }\n      }\n    });\n\n    // Store disposables for cleanup\n    editorRef.current._fullScreenDisposables = {\n      escapeKeyDisposable,\n      changeDisposable,\n      markerChangeDisposable,\n      cursorDisposable\n    };\n  };\n\n  // Cleanup when unmounting\n  useEffect(() => {\n    return () => {\n      if (editorRef.current) {\n        console.log('🟦 Full-screen editor unmounting - cleaning up');\n        // Clear type inference timeout\n        if (typeInferenceTimeoutRef.current) {\n          clearTimeout(typeInferenceTimeoutRef.current);\n        }\n        // Dispose of event listeners\n        if (editorRef.current._fullScreenDisposables) {\n          const disposables = editorRef.current._fullScreenDisposables;\n          disposables.escapeKeyDisposable?.dispose?.();\n          disposables.changeDisposable?.dispose?.();\n          disposables.markerChangeDisposable?.dispose?.();\n          disposables.cursorDisposable?.dispose?.();\n        }\n        editorRef.current = null;\n      }\n    };\n  }, []);\n\n  const handleEditorChange = (newValue: string | undefined) => {\n    onChange(newValue || '');\n  };\n\n  return (\n    <div\n      className={cn(\n        \"uii:relative uii:border uii:rounded-md uii:bg-background\",\n        className\n      )}\n    >\n      <div className=\"uii:flex uii:items-center uii:justify-between uii:p-2 uii:border-b uii:bg-muted/50\">\n        <span className=\"uii:text-sm uii:font-medium\">Expression Editor</span>\n        <button\n          type=\"button\"\n          onClick={onClose}\n          className=\"uii:text-muted-foreground hover:uii:text-foreground uii:p-1 uii:rounded uii:cursor-pointer uii:text-xs\"\n        >\n          ✕\n        </button>\n      </div>\n      <Editor\n        height=\"300px\"\n        theme=\"vs-dark\"\n        language=\"typescript\"\n        value={value}\n        onChange={handleEditorChange}\n        onMount={handleFPEditorDidMount}\n        beforeMount={handleEditorWillMount}\n        options={FullPanelEditorOptions}\n      />\n      {!value && (\n        <div className=\"uii:absolute uii:inset-0 uii:flex uii:items-center uii:justify-center uii:pointer-events-none uii:text-muted-foreground\">\n          {placeholder}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\n\ninterface ASTNode {\n  type: string;\n  value?: string;\n  start: number;\n  end: number;\n  children: ASTNode[];\n  name?: string;\n  operator?: string;\n  left?: ASTNode;\n  right?: ASTNode;\n  argument?: ASTNode;\n  object?: ASTNode;\n  property?: ASTNode;\n  index?: ASTNode;\n  elements?: ASTNode[];\n  params?: ASTNode[];\n  raw?: string;\n  callee?: ASTNode;\n  arguments?: ASTNode[];\n  kind?: string;\n  text?: string;\n}\n\ninterface ParseResult {\n  ast: ASTNode | null;\n  tokens: Array<{type: string, value: string, start: number, end: number}>;\n  dependencies: string[];\n  error?: string;\n}\n\ninterface UseASTParserResult {\n  ast: ASTNode | null;\n  tokens: Array<{type: string, value: string, start: number, end: number}>;\n  dependencies: string[];\n  isLoading: boolean;\n  error: string | null;\n}\n\nexport function useASTParser(expression: string, controlKey?: string): UseASTParserResult {\n  const [ast, setAST] = useState<ASTNode | null>(null);\n  const [tokens, setTokens] = useState<Array<{type: string, value: string, start: number, end: number}>>([]);\n  const [dependencies, setDependencies] = useState<string[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const requestIdRef = useRef<number>(0);\n  const messageHandlerRef = useRef<((event: MessageEvent) => void) | null>(null);\n  const controlKeyRef = useRef<string>(controlKey || 'default');\n  \n  // Update controlKey ref when prop changes\n  useEffect(() => {\n    controlKeyRef.current = controlKey || 'default';\n  }, [controlKey]);\n\n  // Initialize service worker message listener\n  useEffect(() => {\n    if (typeof window === 'undefined' || !navigator.serviceWorker) {\n      setError('Service worker not available');\n      return;\n    }\n\n    // Create message handler\n    const handleMessage = (event: MessageEvent) => {\n      if (event.data.type === 'AST_PARSE_RESULT') {\n        const { id, controlKey, result } = event.data.payload;\n        // Match by both request ID and control key to avoid cross-control contamination\n        if (id === requestIdRef.current && controlKey === controlKeyRef.current) {\n          console.log('Service worker AST response:', { id, controlKey, result });\n          setAST(result.ast);\n          setTokens(result.tokens);\n          setDependencies(result.dependencies || []);\n          setError(result.error || null);\n          setIsLoading(false);\n        } else {\n          console.log('Ignoring AST response - wrong control:', { \n            receivedId: id, \n            expectedId: requestIdRef.current,\n            receivedKey: controlKey,\n            expectedKey: controlKeyRef.current\n          });\n        }\n      }\n    };\n\n    messageHandlerRef.current = handleMessage;\n    navigator.serviceWorker.addEventListener('message', handleMessage);\n\n    return () => {\n      if (messageHandlerRef.current) {\n        navigator.serviceWorker.removeEventListener('message', messageHandlerRef.current);\n      }\n    };\n  }, []);\n\n  // Parse expression when it changes\n  useEffect(() => {\n    if (!expression.trim()) {\n      setAST(null);\n      setTokens([]);\n      setDependencies([]);\n      setError(null);\n      setIsLoading(false);\n      return;\n    }\n\n    if (!navigator.serviceWorker || !navigator.serviceWorker.controller) {\n      setError('Service worker not ready');\n      setIsLoading(false);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    requestIdRef.current++;\n    \n    console.log('Sending expression to service worker:', { \n      expression: expression.trim(), \n      controlKey: controlKeyRef.current,\n      id: requestIdRef.current \n    });\n    \n    // Send message to service worker with control key\n    navigator.serviceWorker.controller.postMessage({\n      type: 'PARSE_AST',\n      payload: {\n        expression: expression.trim(),\n        id: requestIdRef.current,\n        controlKey: controlKeyRef.current\n      }\n    });\n  }, [expression]);\n\n  return {\n    ast,\n    tokens,\n    dependencies,\n    isLoading,\n    error\n  };\n}","import React from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface ASTNode {\n  type: string;\n  value?: string;\n  start: number;\n  end: number;\n  children: ASTNode[];\n  name?: string;\n  operator?: string;\n  left?: ASTNode;\n  right?: ASTNode;\n  argument?: ASTNode;\n  object?: ASTNode;\n  property?: ASTNode;\n  index?: ASTNode;\n  elements?: ASTNode[];\n  params?: ASTNode[];\n}\n\ninterface ASTRendererProps {\n  ast: ASTNode | null;\n  key?: string;\n  className?: string;\n  variant?: 'inline' | 'tree' | 'compact';\n  showTokens?: boolean;\n  tokens?: Array<{ type: string, value: string, start: number, end: number }>;\n}\n\nexport function ASTRenderer({\n  ast, key,\n  className,\n  variant = 'inline',\n  showTokens = false,\n  tokens = []\n}: ASTRendererProps) {\n\n  const getNodeColor = (type: string): string => {\n    switch (type) {\n      case 'StringLiteral':\n        return 'uii:text-green-600 uii:bg-green-100';\n      case 'NumericLiteral':\n        return 'uii:text-purple-600 uii:bg-purple-100';\n      case 'Identifier':\n        return 'uii:text-blue-600 uii:bg-blue-100';\n      case 'Keyword':\n      case 'Literal':\n        return 'uii:text-orange-600 uii:bg-orange-100';\n      case 'BinaryExpression':\n        return 'uii:text-gray-700 uii:bg-gray-100';\n      case 'CallExpression':\n        return 'uii:text-indigo-600 uii:bg-indigo-100';\n      case 'MemberExpression':\n        return 'uii:text-cyan-600 uii:bg-cyan-100';\n      case 'UnaryExpression':\n        return 'uii:text-pink-600 uii:bg-pink-100';\n      case 'ParenthesizedExpression':\n        return 'uii:text-yellow-600 uii:bg-yellow-100';\n      default:\n        return 'uii:text-gray-600 uii:bg-gray-100';\n    }\n  };\n\n  const renderInlineNode = (node: ASTNode, depth: number = 0): React.ReactNode => {\n    if (depth > 2) return null; // Limit depth for inline display\n\n    // For inline display, show a simplified view\n    if (node.type === 'Identifier') {\n      return (\n        <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n          <span className=\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-blue-100 uii:text-blue-800 uii:font-mono\">\n            {node.name || node.value}\n          </span>\n        </span>\n      );\n    }\n\n    if (node.type === 'StringLiteral' || node.type === 'NumericLiteral') {\n      return (\n        <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n          <span className=\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-green-100 uii:text-green-800 uii:font-mono\">\n            {node.value}\n          </span>\n        </span>\n      );\n    }\n\n    if (node.type === 'BinaryExpression') {\n      return (\n        <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n          {node.left && renderInlineNode(node.left, depth + 1)}\n          <span className=\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-purple-100 uii:text-purple-800 uii:font-mono uii:mx-1\">\n            {node.operator}\n          </span>\n          {node.right && renderInlineNode(node.right, depth + 1)}\n        </span>\n      );\n    }\n\n    if (node.type === 'CallExpression') {\n      return (\n        <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n          {(node as any).callee && renderInlineNode((node as any).callee, depth + 1)}\n          <span className=\"text-xs text-gray-600\">()</span>\n        </span>\n      );\n    }\n\n    if (node.type === 'PropertyAccessExpression') {\n      return (\n        <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n          {node.object && renderInlineNode(node.object, depth + 1)}\n          <span className=\"text-xs text-gray-600\">.</span>\n          {node.property && renderInlineNode(node.property, depth + 1)}\n        </span>\n      );\n    }\n\n    // For other types, show a simplified version\n    return (\n      <span key={`${node.start}-${node.end}`} className=\"uii:inline-flex uii:items-center uii:mr-1\">\n        <span className=\"px-1 py-0.5 rounded text-xs bg-gray-100 text-gray-600 font-mono\">\n          {node.type}\n        </span>\n      </span>\n    );\n  };\n\n  const renderTreeNode = (node: ASTNode, depth: number = 0): React.ReactNode => {\n    if (depth > 4) return null; // Limit depth to prevent excessive nesting\n\n    const indent = '  '.repeat(depth);\n\n    return (\n      <div key={`${node.start}-${node.end}`} className=\"font-mono text-xs\">\n        <div className=\"uii:flex uii:items-start uii:gap-2\">\n          <span className=\"uii:text-gray-400\">{indent}</span>\n          <span className={cn(\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:font-semibold\", getNodeColor(node.type))}>\n            {node.type}\n          </span>\n          {node.value && (\n            <span className=\"uii:text-green-600\">\"{node.value}\"</span>\n          )}\n          {node.operator && (\n            <span className=\"uii:text-purple-600\">{node.operator}</span>\n          )}\n          {node.name && (\n            <span className=\"uii:text-blue-600\">{node.name}</span>\n          )}\n        </div>\n\n        {/* Render specific properties more concisely - only if they exist */}\n        {/* Don't render children array if we have specific properties to avoid duplication */}\n        {node.left && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">left: </span>\n            {renderTreeNode(node.left, depth + 1)}\n          </div>\n        )}\n        {node.right && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">right: </span>\n            {renderTreeNode(node.right, depth + 1)}\n          </div>\n        )}\n        {node.argument && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">arg: </span>\n            {renderTreeNode(node.argument, depth + 1)}\n          </div>\n        )}\n        {node.object && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">obj: </span>\n            {renderTreeNode(node.object, depth + 1)}\n          </div>\n        )}\n        {node.property && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">prop: </span>\n            {renderTreeNode(node.property, depth + 1)}\n          </div>\n        )}\n        {node.index && (\n          <div className=\"uii:ml-2\">\n            <span className=\"uii:text-gray-500 uii:text-xs\">idx: </span>\n            {renderTreeNode(node.index, depth + 1)}\n          </div>\n        )}\n\n        {/* Only render children array if we don't have specific properties (to avoid duplication) */}\n        {!node.left && !node.right && !node.argument && !node.object && !node.property && !node.index &&\n          node.children && node.children.length > 0 && (\n            <div className=\"uii:ml-2\">\n              {node.children.slice(0, 3).map((child, index) => renderTreeNode(child, depth + 1))}\n              {node.children.length > 3 && (\n                <div className=\"uii:ml-2 uii:text-gray-500 uii:text-xs\">\n                  ... and {node.children.length - 3} more\n                </div>\n              )}\n            </div>\n          )}\n      </div>\n    );\n  };\n\n  const renderTokens = (): React.ReactNode => {\n    if (tokens.length === 0) return null;\n\n    // Show only the first 10 tokens to avoid overwhelming the UI\n    const displayTokens = tokens.slice(0, 10);\n\n    return (\n      <div className=\"uii:space-y-2\">\n        <div className=\"uii:text-sm uii:font-semibold uii:text-gray-700\">\n          Tokens {tokens.length > 10 && `(${tokens.length} total)`}:\n        </div>\n        <div className=\"uii:flex uii:flex-wrap uii:gap-1\">\n          {displayTokens.map((token, index) => (\n            <span\n              key={index}\n              className={cn(\n                \"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:font-mono\",\n                token.type.includes('Keyword') && \"uii:bg-blue-100 uii:text-blue-800\",\n                token.type.includes('Identifier') && \"uii:bg-green-100 uii:text-green-800\",\n                token.type.includes('String') && \"uii:bg-yellow-100 uii:text-yellow-800\",\n                token.type.includes('Numeric') && \"uii:bg-purple-100 uii:text-purple-800\",\n                token.type.includes('Punctuation') && \"uii:bg-gray-100 uii:text-gray-800\",\n                \"uii:bg-gray-100 uii:text-gray-600\"\n              )}\n            >\n              {token.value}\n            </span>\n          ))}\n          {tokens.length > 10 && (\n            <span className=\"uii:px-1 uii:py-0.5 uii:rounded uii:text-xs uii:bg-gray-200 uii:text-gray-600\">\n              +{tokens.length - 10} more\n            </span>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  if (!ast) {\n    return (\n      <div className={cn(\"uii:text-gray-500 uii:text-sm uii:italic\", className)}>\n        No AST available\n      </div>\n    );\n  }\n\n  if (variant === 'inline') {\n    return (\n      <div className={cn(\"uii:inline-flex uii:items-center uii:gap-2\", className)}>\n        {renderInlineNode(ast)}\n      </div>\n    );\n  }\n\n  if (variant === 'compact') {\n    return (\n      <div className={cn(\"uii:space-y-2\", className)}>\n        <div className=\"uii:flex uii:flex-wrap uii:gap-1\">\n          {renderInlineNode(ast)}\n        </div>\n        {showTokens && renderTokens()}\n      </div>\n    );\n  }\n\n  // Tree variant\n  return (\n    <div className={cn(\"uii:space-y-3\", className)}>\n      <div className=\"uii:space-y-2\">\n        <div className=\"uii:text-sm uii:font-semibold uii:text-gray-700\">AST Tree:</div>\n        <div className=\"uii:p-3 uii:border uii:rounded-md uii:bg-gray-50 uii:max-h-64 uii:overflow-auto\">\n          {renderTreeNode(ast)}\n        </div>\n      </div>\n      {showTokens && renderTokens()}\n    </div>\n  );\n}\n","import React, {\n  useMemo,\n  useCallback,\n  useState,\n  cloneElement,\n  isValidElement,\n  useRef,\n  useEffect,\n} from 'react';\nimport { cn } from '@/lib/utils';\nimport {\n  useExpressionMode,\n  ExpressionModeControls,\n  ExpressionModeState,\n} from '../../hooks/useExpressionMode';\nimport {\n  InlineExpressionEditor,\n  FullPanelExpressionEditor,\n} from './ExpressionEditor';\nimport { ExpressionASTRenderer } from './ExpressionASTRenderer';\nimport { useASTParser } from '../../hooks/useASTParser';\nimport { ASTRenderer } from './ASTRenderer';\nimport clsx from 'clsx';\nimport { useExpressionModeStore } from '../../stores/expressionModeStore';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faChevronLeft,\n  faExpand,\n} from '@fortawesome/pro-regular-svg-icons';\n\n// Types that will come from your API via TRPC\nexport interface ExpressionContext {\n  [key: string]: any;\n}\n\nexport interface ExpressionResult {\n  value: any;\n  ast: ExpressionAST;\n  error?: string;\n  isValid: boolean;\n  validation: {\n    syntax: boolean;\n    expression: boolean;\n    context: boolean;\n    type?: boolean;\n    security?: boolean;\n  };\n}\n\nexport interface ExpressionAST {\n  kind: number;\n  color?: string;\n  left?: ExpressionAST;\n  right?: ExpressionAST;\n  name?: ExpressionAST;\n  argumentExpression?: ExpressionAST;\n  arguments?: ExpressionAST[];\n  expression?: ExpressionAST;\n  escapedText?: string;\n  text?: string;\n  operator?: string;\n  type?: string;\n}\n\nexport interface ExpressionMetadata {\n  expression: string;\n  mode: 'value' | 'expression';\n  value: any;\n  isEditing: boolean;\n  isFullScreen: boolean;\n}\n\nexport interface ExpressionWrapperProps<T = any> {\n  /** The label for the field */\n  label: string;\n  /** The type of the field */\n  type: string;\n  /** The actual value from the form field */\n  value: T | { expression: string; type: 'expression'; value: T };\n  /** Unique key for the field (used for debugging/logging) */\n  key: string;\n  /** Whether the values are loading */\n  valuesLoading?: boolean;\n  /** Callback when the value changes - second parameter contains expression metadata */\n  onValueChange: (\n    value: T | { expression: string; type: 'expression' },\n    metadata?: ExpressionMetadata\n  ) => void;\n  /** Callback when dependencies change - called with array of dependency names */\n  onDependenciesChange?: (dependencies: string[]) => void;\n  /** Current expression metadata (for controlled mode) */\n  metadata?: ExpressionMetadata;\n  /** Render prop function that receives control props */\n  children: (props: {\n\n    value: T;\n\n    onChange: (value: T) => void;\n\n    localInput: T,\n\n    setLocalInput: (value: T) => void;\n\n    expressionMode: ExpressionModeControls;\n\n    onExpressionClick: () => void; // Click handler to trigger expression mode\n\n    inferredType?: string; // TypeScript inferred type of the expression\n\n    hasTypeMismatch?: boolean; // Whether inferred type doesn't match expected type\n\n    hasError?: boolean; // Whether expression has syntax/validation errors\n\n  }) => React.ReactNode;\n  /** Unique field name for the field (used for debugging/logging) */\n  fieldName: string;\n  /** Available nodes for the expression */\n  availableNodes?: any;\n  /** My interface for the expression */\n  myInterface?: any;\n  /** Context variables available in expressions */\n  expressionContext?: ExpressionContext;\n  /** TypeScript type definitions for context variables (for better type inference) */\n  contextTypeDefinitions?: string;\n  /** Whether to use inline editor (default: true = looks like text input) */\n  inlineEditor?: boolean;\n  /** Custom className for the wrapper container */\n  className?: string;\n  /** Custom className for the editor container (when in editor mode) */\n  editorClassName?: string;\n  /** Custom placeholder for expression editor */\n  expressionPlaceholder?: string;\n  /** Function to evaluate expressions - can be TRPC mutation, mock, or any other method */\n  evaluateExpression?: (\n    expression: string,\n    context: ExpressionContext\n  ) => Promise<ExpressionResult>;\n  /** Result of expression evaluation (if parent manages evaluation) */\n  expressionResult?: ExpressionResult | null;\n  /** Whether expression is currently being evaluated (if parent manages evaluation) */\n  isEvaluating?: boolean;\n  /** Whether the current expression is valid (for validation states) */\n  isExpressionValid?: boolean;\n  /** Expected type for the property - used for type coercion validation */\n  expectedType?: 'string' | 'number' | 'boolean' | 'array' | 'object' | 'any';\n}\n\n/**\n * Safely evaluate JavaScript expressions with context\n * TODO: Add more security hardening, sandboxing, and error handling\n */\nfunction evaluateExpressionLocally(\n  expression: string,\n  context: ExpressionContext = {}\n): any {\n  try {\n    // Basic validation\n    if (!expression || typeof expression !== 'string') {\n      return null;\n    }\n\n    // TODO: Add expression validation/whitelist for security\n    // TODO: Add timeout for long-running expressions\n    // TODO: Add memory limits\n    // TODO: Add more comprehensive sandboxing\n\n    // Create a safe evaluation context\n    const safeContext = {\n      ...context,\n      // Add common utility functions\n      Math,\n      Date,\n      JSON,\n      // Add safe array methods\n      Array,\n      // Add safe string methods\n      String,\n      // Add safe number methods\n      Number,\n      // Add safe boolean methods\n      Boolean,\n      // Add safe object methods\n      Object,\n    };\n\n    // Create function with context\n    const func = new Function(\n      ...Object.keys(safeContext),\n      `\"use strict\"; return (${expression});`\n    );\n\n    const result = func(...Object.values(safeContext));\n\n    // TODO: Add result validation and sanitization\n    return result;\n  } catch (error) {\n    console.warn('Expression evaluation failed:', error);\n    // TODO: Add better error reporting and user feedback\n    return null;\n  }\n}\n\n// Validate expression locally for different validation classes\nfunction validateExpressionLocally(\n  expression: string,\n  context: ExpressionContext = {},\n  expectedType: string = 'any'\n): {\n  syntax: boolean;\n  expression: boolean;\n  context: boolean;\n  type: boolean;\n  security: boolean;\n} {\n  const validation = {\n    syntax: true,\n    expression: true,\n    context: true,\n    type: true,\n    security: true,\n  };\n\n  try {\n    // Syntax validation - check if it's valid JavaScript\n    new Function(expression);\n    validation.syntax = true;\n  } catch (error) {\n    validation.syntax = false;\n    return validation; // If syntax is invalid, other validations don't matter\n  }\n\n  try {\n    // Expression validation - check if it's an expression (not a statement)\n    // This is a simple heuristic - expressions typically don't start with keywords\n    const trimmed = expression.trim();\n    const statementKeywords = [\n      'var',\n      'let',\n      'const',\n      'function',\n      'class',\n      'if',\n      'for',\n      'while',\n      'return',\n      'throw',\n    ];\n    validation.expression = !statementKeywords.some((keyword) =>\n      trimmed.startsWith(keyword)\n    );\n  } catch (error) {\n    validation.expression = false;\n  }\n\n  try {\n    // Context validation - check if referenced variables exist in context\n    const contextKeys = Object.keys(context);\n    const variableRegex = /\\b[a-zA-Z_$][a-zA-Z0-9_$]*\\b/g;\n    const matches = expression.match(variableRegex) || [];\n    const referencedVars = Array.from(new Set(matches));\n\n    // Filter out JavaScript built-ins and keywords\n    const jsBuiltins = [\n      'true',\n      'false',\n      'null',\n      'undefined',\n      'this',\n      'new',\n      'typeof',\n      'instanceof',\n    ];\n    const userVars = referencedVars.filter((v) => !jsBuiltins.includes(v));\n\n    validation.context = userVars.every((v) => contextKeys.includes(v));\n  } catch (error) {\n    validation.context = false;\n  }\n\n  // Type validation - check if expression result can be coerced to expected type\n  try {\n    const evaluated = evaluateExpressionLocally(expression, context);\n    validation.type =\n      evaluated !== null\n        ? validateTypeCoercion(evaluated, expectedType)\n        : false;\n  } catch (error) {\n    validation.type = false;\n  }\n\n  // Security validation - check for dangerous operations\n  const dangerousPatterns = [\n    /eval\\s*\\(/,\n    /Function\\s*\\(/,\n    /setTimeout\\s*\\(/,\n    /setInterval\\s*\\(/,\n    /import\\s*\\(/,\n    /require\\s*\\(/,\n  ];\n  validation.security = !dangerousPatterns.some((pattern) =>\n    pattern.test(expression)\n  );\n\n  return validation;\n}\n\n// Validate if a value can be coerced to the expected type\nfunction validateTypeCoercion(value: any, expectedType: string): boolean {\n  if (expectedType === 'any') return true;\n\n  try {\n    switch (expectedType) {\n      case 'string':\n        // Most values can be coerced to string\n        return value !== null && value !== undefined;\n\n      case 'number':\n        // Check if value can be converted to a valid number\n        if (typeof value === 'number') return !isNaN(value);\n        if (typeof value === 'string') {\n          const num = Number(value);\n          return !isNaN(num) && isFinite(num);\n        }\n        if (typeof value === 'boolean') return true; // true -> 1, false -> 0\n        return false;\n\n      case 'boolean':\n        // Most values can be coerced to boolean\n        return true; // JavaScript's truthy/falsy conversion\n\n      case 'array':\n        // Check if value is already an array or can be converted\n        if (Array.isArray(value)) return true;\n        if (typeof value === 'string') return true; // String can be split into array\n        if (typeof value === 'object' && value !== null) return true; // Object can be Object.entries()\n        return false;\n\n      case 'object':\n        // Check if value is an object or can be converted\n        if (typeof value === 'object' && value !== null) return true;\n        if (typeof value === 'string') return true; // String can be parsed as JSON\n        if (typeof value === 'number' || typeof value === 'boolean')\n          return true; // Can be wrapped in object\n        return false;\n\n      default:\n        return true;\n    }\n  } catch (error) {\n    return false;\n  }\n}\n\n/**\n * ExpressionWrapper - Wraps any control with expression capabilities\n *\n * This component provides three modes:\n * 1. Value mode: Shows the wrapped control normally\n * 2. Expression mode: Shows the evaluated expression result\n * 3. Editor mode: Shows the Monaco editor for editing expressions\n */\nexport function ExpressionWrapper<T = any>({\n  label,\n  value,\n  type,\n  valuesLoading = false,\n  key,\n  onValueChange,\n  onDependenciesChange,\n  metadata,\n  children,\n  fieldName,\n  expressionContext = {},\n  availableNodes,\n  myInterface,\n  contextTypeDefinitions,\n  inlineEditor = true,\n  className,\n  editorClassName,\n  expressionPlaceholder = 'Enter expression...',\n  evaluateExpression,\n  expressionResult,\n  isEvaluating = false,\n  isExpressionValid = true,\n  expectedType = 'any',\n}: ExpressionWrapperProps<T>) {\n  // Internal state to track expression metadata (preserves expression when switching modes)\n  const [expressionMetadata, setExpressionMetadata] =\n    useState<ExpressionMetadata>(\n      () => {\n        // On initial load, always start in value mode (not editing)\n        // Even if metadata says isEditing: true, that's stale state from previous session\n        const initialMetadata = metadata || {\n          expression: '',\n          mode: 'value',\n          isEditing: false,\n          isFullScreen: false,\n          value: undefined,\n        };\n\n        // Force isEditing and isFullScreen to false on initial load\n        return {\n          ...initialMetadata,\n          isEditing: false,\n          isFullScreen: false,\n          mode: 'value', // Always start in value mode\n        };\n      }\n    );\n\n  // Track the original value before any expression was set\n  const [originalValue, setOriginalValue] = useState<T>(\n    value &&\n      typeof value === 'object' &&\n      'expression' in value &&\n      'type' in value &&\n      value.type === 'expression'\n      ? value.value\n      : (value as T)\n  );\n  const [currentValue, setCurrentValue] = useState<T>(\n    value &&\n      typeof value === 'object' &&\n      'expression' in value &&\n      'type' in value &&\n      value.type === 'expression'\n      ? value.value\n      : (value as T)\n  );\n\n  const formatValue = useCallback((value: T | unknown) => {\n\n    switch (type) {\n      case \"float\":\n        {\n          return (typeof value === \"string\") && !isNaN(parseFloat(value as string)) ? parseFloat(value as string) : value\n        }\n      case \"integer\":\n      case \"number\":\n        {\n          return (typeof value === \"string\") && !isNaN(parseInt(value as string)) ? parseInt(value as string) : value\n          break\n        }\n      case \"string[]\":\n        {\n          return (typeof value === \"string\") ? (value as string).split(',') : value as T\n          break\n        }\n      case \"string\":\n      default:\n        {\n          return value as T\n        }\n    }\n  }, [type])\n\n  const [currentEditorValue, setCurrentEditorValue] = useState<string>();\n\n  const currentExpressionValueExt = useExpressionModeStore\n    .getState()\n    .getState(fieldName).expression;\n\n  // Update internal metadata when external metadata changes\n  useEffect(() => {\n    if (metadata) {\n      // When receiving external metadata updates, preserve editing state but\n      // don't automatically enter editing mode on initial load\n      setExpressionMetadata({\n        ...metadata,\n        // Don't restore editing/fullscreen state from metadata\n        // User needs to explicitly click to edit\n        isEditing: false,\n        isFullScreen: false,\n      });\n    }\n  }, [metadata]);\n\n  // Detect if incoming value is an expression object\n  const isExpressionValue = useMemo(() => {\n    return (\n      value &&\n      typeof value === 'object' &&\n      'expression' in value &&\n      'type' in value &&\n      value.type === 'expression'\n    );\n  }, [value]);\n\n  // Track if this is the initial mount\n  const isInitialMount = useRef(true);\n\n  useEffect(() => {\n\n\n    if (\n      value &&\n      typeof value === 'object' &&\n      'expression' in value &&\n      'type' in value &&\n      value.type === 'expression'\n    ) {\n      // Expression object detected\n      const exprValue = (value as any).value;\n      const exprString = (value as any).expression;\n\n      // Set the current value (the evaluated result to display)\n      if (exprValue !== undefined) {\n        setCurrentValue(formatValue(exprValue) as T);\n        setOriginalValue(formatValue(exprValue) as T);\n      }\n\n      // Set the expression in the store AND switch to expression mode (non-editing)\n      // This ensures the expression display is shown\n      if (exprString && expressionMode.expression !== exprString) {\n        expressionMode.setExpression(exprString);\n        // Only switch to expression mode on initial load, not during editing\n        if (isInitialMount.current && !expressionMode.isEditing) {\n          expressionMode.switchToExpression();\n        }\n      }\n\n      // On initial load, sync metadata to match the expression in the value\n      // Check if metadata is out of sync\n      const isMetadataOutOfSync =\n        !metadata ||\n        metadata.expression !== exprString ||\n        metadata.mode === 'value' ||  // If value has expression but mode is 'value', it's out of sync\n        metadata.isEditing === true ||  // Should never start editing on load\n        metadata.isFullScreen === true; // Should never start full-screen on load\n\n      if (isInitialMount.current && isMetadataOutOfSync) {\n        const syncedMetadata: ExpressionMetadata = {\n          expression: exprString || '',\n          value: formatValue(exprValue),\n          mode: 'expression', // Show expression display (not editing)\n          isEditing: false,\n          isFullScreen: false,\n        };\n\n        // Use setTimeout to avoid calling onValueChange during render\n        setTimeout(() => {\n          onValueChange(value, { ...syncedMetadata, value: formatValue(value) });\n        }, 0);\n      }\n    } else {\n      // Regular value (not an expression object)\n      if (!valuesLoading) {\n        setCurrentValue(formatValue(value) as T);\n        setOriginalValue(formatValue(value) as T);\n\n        // Sync metadata - clear any expression metadata since we have a plain value\n        if (isInitialMount.current && (metadata?.expression || metadata?.mode === 'expression')) {\n          const syncedMetadata: ExpressionMetadata = {\n            expression: '',\n            value: formatValue(value),\n            mode: 'value',\n            isEditing: false,\n            isFullScreen: false,\n          };\n\n          // Use setTimeout to avoid calling onValueChange during render\n          setTimeout(() => {\n            onValueChange(formatValue(value) as T, { ...syncedMetadata, value: formatValue(value) });\n          }, 0);\n        }\n      }\n    }\n\n    // Mark that initial mount is complete after a short delay\n    if (isInitialMount.current) {\n      setTimeout(() => {\n        isInitialMount.current = false;\n      }, 100);\n    }\n  }, [value, valuesLoading]);\n\n  // Update metadata when value changes to/from expression\n  // useEffect(() => {\n  //   if (isExpressionValue) {\n  //     // Value is an expression object, switch to expression mode\n  //     const newMetadata: ExpressionMetadata = {\n  //       expression: (value as any).expression,\n  //       mode: 'expression',\n  //       isEditing: false\n  //     };\n  //     setExpressionMetadata(newMetadata);\n  //   } else if (expressionMetadata.mode === 'value') {\n  //     // This is a regular value and we're in value mode, update original value\n  //     setOriginalValue(value);\n  //   }\n  // }, [value, isExpressionValue, expressionMetadata.mode]);\n\n  // Convert internal metadata to ExpressionModeState format\n  // const externalState: ExpressionModeState = {\n  //   expression: expressionMetadata.expression,\n  //   mode: expressionMetadata.mode,\n  //   isEditing: expressionMetadata.isEditing,\n  //   isFullScreen: expressionMetadata.isFullScreen,\n  //   currentValue: value\n  // };\n\n  // // Handle state changes by updating internal metadata and parent\n  // const handleStateChange = useCallback((newState: ExpressionModeState) => {\n\n  //   // const newMetadata: ExpressionMetadata = {\n  //   //   expression: newState.expression,\n  //   //   mode: newState.mode,\n  //   //   isEditing: newState.isEditing\n  //   // };\n\n  //   // // Update internal state\n  //   // setExpressionMetadata(newMetadata);\n\n  //   // // Notify parent\n  //   // onValueChange(value, newMetadata);\n\n  //   console.log(\"handleStateChange called with:\", newState);\n\n  // }, [onValueChange, value]);\n\n  const expressionMode = useExpressionMode(fieldName);\n\n  // Parse expression and extract AST + dependencies\n  const {\n    ast,\n    tokens,\n    dependencies,\n    isLoading: isParsing,\n    error: parseError,\n  } = useASTParser(expressionMode.expression, fieldName);\n\n  // Memoized dependency list with additional metadata\n  const dependencyList = useMemo(() => {\n    if (!ast || dependencies.length === 0) {\n      return [];\n    }\n\n    // Create a structured list of dependencies with metadata\n    // The service worker now filters out built-in methods properly\n    return dependencies.map((dep) => ({\n      name: dep,\n      exists: expressionContext ? dep in expressionContext : false,\n      value: expressionContext ? expressionContext[dep] : undefined,\n    }));\n  }, [dependencies, expressionContext, ast]);\n\n  // Store TypeScript type information from Monaco editor\n  const [typeScriptInferredType, setTypeScriptInferredType] = useState<string | null>(null);\n\n  // Callback to receive type information from the editor\n  const handleTypeInferred = useCallback((type: string) => {\n    setTypeScriptInferredType(type);\n  }, []);\n\n  // Type inference is now handled directly by the editors (inline and full-screen)\n  // No need for the legacy async approach - editors call handleTypeInferred callback\n\n  // Check if expression contains newlines - if so, we should use full-screen editor\n  const expressionHasNewlines = useMemo(() => {\n    return expressionMode.expression.includes('\\n') || expressionMode.expression.includes('\\r');\n  }, [expressionMode.expression]);\n\n  // Use TypeScript-based type inference from Monaco (always available)\n  const inferredReturnType = useMemo(() => {\n    // Monaco's TypeScript language service provides accurate type inference\n    return typeScriptInferredType || 'unknown';\n  }, [typeScriptInferredType]);\n\n  // Check if inferred type matches the expected type prop\n  const hasTypeMismatch = useMemo(() => {\n    // Don't show type mismatch if there's an error or unknown type\n    if (!inferredReturnType || inferredReturnType === 'unknown' || inferredReturnType === 'any' || inferredReturnType === 'error') {\n      return false;\n    }\n\n    // Normalize types for comparison\n    const normalizedInferred = inferredReturnType.toLowerCase().trim();\n    const normalizedExpected = (type || expectedType || 'any').toLowerCase().trim();\n\n    // Handle array types: 'string[]' should match 'array'\n    if (normalizedExpected === 'array' && normalizedInferred.endsWith('[]')) {\n      return false; // Not a mismatch\n    }\n\n    // Handle exact matches\n    if (normalizedInferred === normalizedExpected) {\n      return false; // Not a mismatch\n    }\n\n    // If expected type is 'any', never a mismatch\n    if (normalizedExpected === 'any') {\n      return false;\n    }\n\n    // Handle TypeScript literal types - they're compatible with their base type\n    // String literals: \"adam\" is compatible with string\n    if (normalizedExpected === 'string' &&\n      (normalizedInferred.startsWith('\"') || normalizedInferred.startsWith(\"'\"))) {\n      return false; // String literal is compatible with string\n    }\n\n    // Number literals: 123, 123.45, 10e3, etc. are compatible with number\n    if (normalizedExpected === 'number' && /^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(normalizedInferred)) {\n      return false; // Number literal is compatible with number\n    }\n\n    // Integer literals: 123, 10e3, etc. are compatible with integer\n    if (normalizedExpected === 'integer' && /^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(normalizedInferred)) {\n      return false; // Number literal is compatible with integer\n    }\n\n    // Number type is compatible with integer (Monaco might infer \"number\" for integers)\n    if (normalizedExpected === 'integer' && normalizedInferred === 'number') {\n      return false; // Number is compatible with integer\n    }\n\n    // Float literals: 123.45, 10e3, etc. are compatible with float\n    if (normalizedExpected === 'float' && /^-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?$/.test(normalizedInferred)) {\n      return false; // Number literal is compatible with float\n    }\n\n    // Number type is compatible with float\n    if (normalizedExpected === 'float' && normalizedInferred === 'number') {\n      return false; // Number is compatible with float\n    }\n\n    // Boolean literals: true/false is compatible with boolean\n    if (normalizedExpected === 'boolean' &&\n      (normalizedInferred === 'true' || normalizedInferred === 'false')) {\n      return false; // Boolean literal is compatible with boolean\n    }\n\n    // Otherwise, there's a mismatch\n    return true;\n  }, [inferredReturnType, type, expectedType]);\n\n  // Internal state for expression evaluation (when wrapper handles it)\n  const [internalExpressionResult, setInternalExpressionResult] =\n    useState<ExpressionResult | null>(null);\n  const [internalIsEvaluating, setInternalIsEvaluating] = useState(false);\n\n  // Hover state for expression preview\n  const [isHovering, setIsHovering] = useState(false);\n\n  // Internal Monaco validation state\n  const [internalIsExpressionValid, setInternalIsExpressionValid] =\n    useState(true);\n\n  // Detailed validation state for different validation classes\n  const [validationState, setValidationState] = useState({\n    syntax: true,\n    expression: true,\n    context: true,\n    type: true,\n    security: true,\n  });\n\n  // Check if expression has any errors\n  const hasExpressionError = useMemo(() => {\n    // No expression = no error\n    if (!expressionMode.expression || !expressionMode.expression.trim()) {\n      return false;\n    }\n\n    // Check Monaco validation errors\n    if (!internalIsExpressionValid || !isExpressionValid) {\n      return true;\n    }\n\n    // Check AST parsing errors\n    if (parseError) {\n      return true;\n    }\n\n    // Check validation state\n    if (!validationState.syntax || !validationState.expression) {\n      return true;\n    }\n\n    // Check if there's an evaluation error\n    if (expressionResult?.error || internalExpressionResult?.error) {\n      return true;\n    }\n\n    return false;\n  }, [\n    expressionMode.expression,\n    internalIsExpressionValid,\n    isExpressionValid,\n    parseError,\n    validationState,\n    expressionResult,\n    internalExpressionResult\n  ]);\n\n  // Track if we should use full editor (when expression becomes multi-line)\n  // const [shouldUseFullEditor, setShouldUseFullEditor] = useState(false);\n\n  // Track if we're programmatically clearing to prevent blur handler from firing\n  const isProgrammaticallyClearing = useRef(false);\n\n  // Track if we're switching to full-screen to prevent blur handler from firing\n  const isSwitchingToFullScreen = useRef(false);\n\n  // Track if we're programmatically clearing to prevent blur handler from firing\n  const isBlur = useRef(false);\n\n  // Handle Monaco validation changes\n  const handleValidationChange = useCallback(\n    (isValid: boolean, errors: any[]) => {\n      setInternalIsExpressionValid(isValid);\n\n      // Update syntax validation (Monaco's built-in validation)\n      setValidationState((prev) => ({\n        ...prev,\n        syntax: isValid,\n      }));\n    },\n    []\n  );\n\n  // Check if expression content requires full editor\n  const checkForMultiLine = useCallback(\n    (expression: string) => {\n      const hasNewlines = expression.includes('\\n');\n      const isLong = expression.length > 80; // Arbitrary threshold for \"long\" expressions\n      if (!expressionMode.isFullScreen) {\n        expressionMode.setFullScreen(hasNewlines || isLong);\n      }\n    },\n    [expressionMode.isFullScreen]\n  );\n\n  // Internal evaluation function\n  const internalEvaluateExpression = useCallback(\n    async (expression: string, context: ExpressionContext) => {\n      if (!evaluateExpression || !expression.trim()) return;\n\n      setInternalIsEvaluating(true);\n      try {\n        const result = await evaluateExpression(expression, context);\n        setInternalExpressionResult(result);\n      } catch (error) {\n        // console.error('Expression evaluation failed:', error);\n        setInternalExpressionResult({\n          value: null,\n          ast: { kind: 0, text: '', color: '#ff0000' },\n          error: error instanceof Error ? error.message : 'Unknown error',\n          isValid: false,\n          validation: {\n            syntax: false,\n            expression: false,\n            context: false,\n            type: false,\n            security: false,\n          },\n        });\n      } finally {\n        setInternalIsEvaluating(false);\n      }\n    },\n    [evaluateExpression]\n  );\n\n  // TODO: Add error boundary for expression evaluation\n  // TODO: Add loading states for complex expressions\n  // TODO: Add validation for fieldName uniqueness\n\n  // Evaluate expression and determine current value\n  // const currentValue = useMemo(() => {\n\n  //   if (expressionMode.isExpressionMode && expressionMode.expression) {\n  //     // If we have an expression result (from parent or internal), use it\n  //     // const result = expressionResult || internalExpressionResult;\n  //     // if (result?.isValid) {\n  //     //   return result.value;\n  //     // }\n\n  //     // // Use stored currentValue from metadata if available\n  //     // if (expressionMode.currentValue !== undefined) {\n  //     //   return expressionMode.currentValue;\n  //     // }\n\n  //     // Fallback to local evaluation\n  //     // try {\n  //     //   const evaluated = evaluateExpressionLocally(expressionMode.expression, expressionContext);\n  //     //   return evaluated !== null ? evaluated : value;\n  //     // } catch (error) {\n  //     //   console.warn('Expression evaluation failed:', error);\n  //     //   return value;\n  //     // }\n  //     return currentExpressionValueExt;\n\n  //   }\n\n  //   return originalValue || value;\n\n  // }, [expressionMode.isExpressionMode, expressionMode.expression, expressionMode.currentValue, expressionContext, value, expressionResult, internalExpressionResult]);\n\n  const currentMetadata = useMemo(() => {\n    return {\n      expression: expressionMode.expression,\n      value: currentValue,\n      mode: expressionMode.current,\n      isEditing: expressionMode.isEditing,\n      isFullScreen: expressionMode.isFullScreen,\n    };\n  }, [\n    expressionMode.expression,\n    expressionMode.current,\n    expressionMode.isFullScreen,\n    expressionMode.isEditing,\n    currentValue,\n  ]);\n\n  const currentExpressionValue = useMemo(() => {\n    return { expression: expressionMode.expression, type: 'expression' };\n  }, [expressionMode.currentValue || expressionMode.expression]);\n\n  // Handle value changes from wrapped control\n  const handleValueChange = useCallback(\n    (newValue: T) => {\n      // Only pass metadata if we're in expression mode OR if the new value is an expression\n\n      // const currentMetadata: ExpressionMetadata | undefined =\n\n      // (expressionMode.current === 'value' && !isExpressionValue) ? undefined : {\n      //     expression: expressionMode.expression,\n      //     mode: expressionMode.current,\n      //     isEditing: expressionMode.isEditing\n      //   };\n\n      // console.log(\"handleValueChange called with:\", { newValue: newValue, currentMetadata: currentMetadata });\n      onValueChange(formatValue(newValue) as T, { ...currentMetadata, value: formatValue(newValue) });\n    },\n    [onValueChange, expressionMode, isExpressionValue, currentValue]\n  );\n\n  // // Handle onChange events (for controls that pass events)\n  // const handleChange = useCallback((event: any) => {\n  //   // const currentMetadata: ExpressionMetadata = {\n  //   //   expression: expressionMode.expression,\n  //   //   mode: expressionMode.current,\n  //   //   isEditing: expressionMode.isEditing\n  //   // };\n\n  //   if (event && event.target && typeof event.target.value !== 'undefined') {\n  //     // Handle input change events\n  //     onValueChange(event.target.value as T, currentMetadata);\n  //   } else if (typeof event === 'boolean') {\n  //     // Handle switch/checkbox events\n  //     onValueChange(event as T, currentMetadata);\n  //   } else {\n  //     // Handle direct value changes\n  //     onValueChange(event as T, currentMetadata);\n  //   }\n  // }, [onValueChange, expressionMode]);\n\n  // Handle expression changes\n  const handleExpressionChange = useCallback(\n    (newExpression: string) => {\n      // console.log(\"handleExpressionChange\", newExpression);\n      // console.log(\"Current expressionMode.expression before set:\", expressionMode.expression);\n\n      // Reset the clearing flag when expression changes (user is typing)\n      isProgrammaticallyClearing.current = false;\n\n      expressionMode.setExpression(newExpression);\n      setCurrentEditorValue(newExpression);\n      // console.log(\"Current expressionMode.expression after set:\", expressionMode.expression);\n\n      // Check if content requires full editor\n      checkForMultiLine(newExpression);\n\n      // Update validation state for local validation\n      // const localValidation = validateExpressionLocally(newExpression, expressionContext, expectedType);\n      // setValidationState(localValidation);\n\n      // // If wrapper handles evaluation internally, trigger it\n      // if (evaluateExpression) {\n      //   internalEvaluateExpression(newExpression, expressionContext);\n      // }\n\n      // console.log(\"handleExpressionChange calling onValueChange with:\", { expression: newExpression, type: 'expression' });\n\n      onValueChange({ expression: newExpression, type: 'expression' } as T, {\n        ...currentMetadata,\n        expression: newExpression,\n      });\n\n      // If in expression mode, update the actual value (fallback to local evaluation)\n      // if (expressionMode.isExpressionMode && !evaluateExpression) {\n      //   try {\n      //     const evaluated = evaluateExpressionLocally(newExpression, expressionContext);\n      //     if (evaluated !== null) {\n      //       // Store the evaluated value in metadata state\n      //       expressionMode.setCurrentValue(evaluated);\n\n      //       const currentMetadata: ExpressionMetadata = {\n      //         expression: newExpression,\n      //         mode: expressionMode.current,\n      //         isEditing: expressionMode.isEditing\n      //       };\n      //       onValueChange(evaluated, currentMetadata);\n      //     }\n      //   } catch (error) {\n      //     // Keep current value\n      //   }\n      // }\n    },\n    [\n      expressionMode,\n      expressionContext,\n      onValueChange,\n      evaluateExpression,\n      internalEvaluateExpression,\n      checkForMultiLine,\n    ]\n  );\n\n  // Handle expression editor blur - switch to expression mode and update value if needed\n  const handleExpressionBlur = useCallback(\n    async (e?: any, forceBlur = false) => {\n\n      // If we're programmatically clearing, don't execute blur logic\n      if (isProgrammaticallyClearing.current) {\n        isProgrammaticallyClearing.current = false;\n        return;\n      }\n\n      // If we're switching to full-screen, don't execute blur logic\n      if (isSwitchingToFullScreen.current) {\n        isSwitchingToFullScreen.current = false;\n        return;\n      }\n\n      // Don't process blur if in full-screen mode (multi-line editing)\n      // UNLESS this is a forced blur (like clicking the X button)\n      if (expressionMode.isFullScreen && !forceBlur) {\n        return;\n      }\n\n      // Don't process blur if expression has newlines (should be in full-screen)\n      // UNLESS this is a forced blur\n      if (expressionHasNewlines && !forceBlur) {\n        return;\n      }\n\n      isBlur.current = true;\n\n      expressionMode.setEditing(false);\n      expressionMode.setFullScreen(false);\n\n      // console.log(\"handleExpressionBlur called\", { currentExpressionValue: currentExpressionValue, currentEditorValue: currentEditorValue, currentExpressionValueExt: currentExpressionValueExt });\n\n      // Reset full editor flag since we're leaving editor mode\n    },\n    [\n      expressionMode,\n      expressionResult,\n      internalExpressionResult,\n      expressionContext,\n      onValueChange,\n      currentValue,\n      isEvaluating,\n      internalIsEvaluating,\n      currentExpressionValue,\n      expressionHasNewlines,\n    ]\n  );\n\n  useEffect(() => {\n    onValueChange(currentValue as T, {\n      ...currentMetadata,\n      isFullScreen: expressionMode.isFullScreen,\n    });\n  }, [expressionMode.isFullScreen]);\n\n  // Auto-switch to full-screen mode if newlines are detected while editing\n  useEffect(() => {\n    if (expressionMode.isEditing && expressionHasNewlines && !expressionMode.isFullScreen) {\n      expressionMode.setFullScreen(true);\n    }\n  }, [expressionHasNewlines, expressionMode.isEditing, expressionMode.isFullScreen]);\n\n  // // Auto-switch to value mode if expression becomes empty after blur\n  // useEffect(() => {\n  //   // Only check when blur just happened\n  //   if (isBlur.current) {\n  //     isBlur.current = false; // Reset the flag\n\n  //     // If expression is empty or only whitespace, switch to value mode\n  //     if (!expressionMode.expression || !expressionMode.expression.trim()) {\n  //       console.log('Expression is empty after blur - switching to value mode');\n  //       expressionMode.switchToValue();\n  //     }\n  //   }\n  // }, [expressionMode.isEditing]); // Trigger when isEditing changes (blur sets it to false)\n\n  const handleModeChange = useCallback(\n    (newMode: 'value' | 'expression' | 'editor') => {\n      switch (newMode) {\n        case 'value':\n          // When switching to value mode, update the original value to current value\n          // setOriginalValue(currentValue);\n\n          expressionMode.switchToValue();\n\n          expressionMode.setFullScreen(false); // Reset full editor flag\n\n          // Update form state with the actual value (not expression object)\n          onValueChange(originalValue || value, undefined);\n          break;\n        case 'editor':\n          // setOriginalValue(currentValue);\n          expressionMode.switchToEditor();\n\n          // If expression has newlines, automatically go to full-screen\n          const shouldBeFullScreen = expressionHasNewlines;\n          if (shouldBeFullScreen) {\n            expressionMode.setFullScreen(true);\n          }\n\n          // Update metadata to reflect editing state\n          const editorMetadata: ExpressionMetadata = {\n            expression: expressionMode.expression,\n            value: currentValue,\n            mode: 'expression',\n            isEditing: true,\n            isFullScreen: shouldBeFullScreen,\n          };\n\n          // Notify parent that editing started\n          onValueChange(\n            expressionMode.expression\n              ? { expression: expressionMode.expression, type: 'expression' } as T\n              : currentValue as T,\n            editorMetadata\n          );\n          break;\n        case 'expression':\n          // Store the current value before switching to expression mode\n          setOriginalValue(currentValue);\n\n          expressionMode.switchToExpression();\n\n          // If expression has newlines, automatically go to full-screen when editing\n          if (expressionHasNewlines) {\n            expressionMode.setFullScreen(true);\n          }\n\n          // break;\n          // expressionMode.switchToEditor();\n\n          break;\n      }\n    },\n    [expressionMode, currentValue, onValueChange, expressionHasNewlines, originalValue, value]\n  );\n\n  useEffect(() => {\n    // This is for blur detection ... it seems to work quite a bit better than the onBlur event as long\n    // as we use the onBlur event to trigger out of editing mode we can watch for that and update values\n    // accordinly\n    // if (\n    //   !expressionMode.isEditing &&\n    //   !(expressionMode.expression && expressionMode.expression.trim())\n    // ) {\n    //   expressionMode.switchToValue();\n    // }\n    if (isBlur.current) {\n      if (!(expressionMode.expression && expressionMode.expression.trim())) {\n        expressionMode.switchToValue();\n        onValueChange(currentMetadata.value ?? '' as T, {\n          ...currentMetadata,\n          mode: 'value',\n          expression: '',\n          isEditing: false,\n          isFullScreen: false,\n        });\n      } else {\n        onValueChange(\n          currentMetadata.mode === 'value'\n            ? (currentMetadata.value ?? '' as T)\n            : ({\n              expression: currentMetadata.expression.trim(),\n              type: 'expression',\n            } as T),\n          { ...currentMetadata, isEditing: false, isFullScreen: false }\n        );\n      }\n      isBlur.current = false;\n    }\n  }, [expressionMode.isEditing, expressionMode.isFullScreen, isBlur.current]);\n\n  // Notify parent when dependencies change\n  useEffect(() => {\n    if (onDependenciesChange) {\n      onDependenciesChange(dependencies);\n    }\n  }, [dependencies, onDependenciesChange]);\n\n  // Handle clear\n  const handleClear = useCallback(() => {\n    // Set flag to prevent blur handler from executing\n    isProgrammaticallyClearing.current = true;\n\n    // const currentMetadata: ExpressionMetadata = {\n    //   expression: '',\n    //   mode: 'value',\n    //   isEditing: false\n    // };\n\n    // Return to the original value when clearing the expression\n    onValueChange(currentValue as T, currentMetadata);\n    handleModeChange('value');\n    // expressionMode.clear();\n    expressionMode.setFullScreen(false); // Reset full editor flag\n  }, [onValueChange, expressionMode, originalValue]);\n\n\n  const [localInput, setLocalInput] = useState(currentValue);\n\n  useEffect(() => {\n\n    setLocalInput(currentValue)\n\n  }, [currentValue])\n\n  // Create control props for render prop pattern\n  const controlProps = useMemo(\n    () => ({\n      value: currentValue as T,\n      onChange: handleValueChange,\n      onExpressionClick: () => handleModeChange('editor'), // Click handler to trigger expression mode\n      inferredType: inferredReturnType, // Inferred TypeScript type\n      hasTypeMismatch: hasTypeMismatch, // Whether inferred type matches expected\n      hasError: hasExpressionError, // Whether expression has syntax/validation errors\n      localInput,\n      setLocalInput,\n      expressionMode: {\n        current: expressionMode.current,\n        switchToValue: () => handleModeChange('value'),\n        switchToExpression: () => handleModeChange('expression'),\n        switchToEditor: () => handleModeChange('editor'),\n        clear: handleClear,\n        isExpressionMode: expressionMode.isExpressionMode,\n        isEditorMode: expressionMode.isEditorMode,\n        expression: expressionMode.expression,\n        setExpression: handleExpressionChange,\n        isEditing: expressionMode.isEditing,\n        setEditing: expressionMode.setEditing,\n        isFullScreen: expressionMode.isFullScreen,\n        setFullScreen: expressionMode.setFullScreen,\n      } as ExpressionModeControls,\n    }),\n    [\n      currentValue,\n      handleValueChange,\n      expressionMode,\n      handleModeChange,\n      handleClear,\n      handleExpressionChange,\n      inferredReturnType,\n      hasTypeMismatch,\n      hasExpressionError,\n    ]\n  );\n\n  // Render based on current mode\n  const renderContent = () => {\n    switch (expressionMode.current) {\n      // case 'value':\n      //   return children(controlProps);\n\n      case 'expression':\n        // Determine what to show based on state\n        const hasExpression =\n          expressionMode.expression && expressionMode.expression.trim();\n        const hasValidAST = (expressionResult || internalExpressionResult)\n          ?.isValid;\n        const isValidExpression =\n          isExpressionValid && internalIsExpressionValid;\n\n        // If no expression is set, automatically switch back to value mode\n        // if (!hasExpression) {\n        //   console.log('Expression mode render: no expression, switching to value mode', {\n        //     expression: expressionMode.expression,\n        //     hasExpression,\n        //     currentMode: expressionMode.current\n        //   });\n        //   // Use setTimeout to avoid state update during render\n        //   setTimeout(() => {\n        //     expressionMode.switchToValue();\n        //     // Clear the expression from metadata when switching to value mode due to empty expression\n        //     const clearedMetadata: ExpressionMetadata = {\n        //       expression: '',\n        //       mode: 'value',\n        //       isEditing: false\n        //     };\n        //     onValueChange(value, clearedMetadata);\n        //   }, 0);\n        //   // Return value mode content while switching\n        //   return children(controlProps);\n        // }\n\n        return controlProps.expressionMode.isEditing ? (\n          <div key={`${key}-expression`} className={cn('relative', className)}>\n            {inlineEditor && !expressionMode.isFullScreen && !expressionHasNewlines ? (\n              <div\n                className={cn(\n                  `uii:flex uii:h-9 uii:w-full \n              uii:min-w-0 uii:rounded-sm \n              uii:border uii:border-ring \n              uii:bg-background uii:px-3 uii:py-1 uii:text-base uii:shadow-xs \n              uii:ring-ring/50 uii:ring-[3px] uii:transition-[color,box-shadow] \n              uii:outline-none uii:md:text-sm uii:cursor-pointer\n              uii:mt-0.5 `,\n                  editorClassName\n                )}\n              >\n                <InlineExpressionEditor\n                  value={expressionMode.expression}\n                  onChange={(newValue) => {\n                    // console.log(\"InlineExpressionEditor onChange called with:\", newValue);\n                    handleExpressionChange(newValue);\n                  }}\n                  onEnter={() => {\n                    // Switch to full-screen mode instead of blurring\n                    // Set flag to prevent blur handler from closing the editor\n                    isSwitchingToFullScreen.current = true;\n                    expressionMode.setFullScreen(true);\n\n                    // Reset flag after a short delay in case blur doesn't fire\n                    setTimeout(() => {\n                      isSwitchingToFullScreen.current = false;\n                    }, 100);\n                  }}\n                  onBlur={handleExpressionBlur}\n                  onTypeInferred={handleTypeInferred}\n                  onValidationChange={handleValidationChange}\n                  context={expressionContext}\n                  placeholder={expressionPlaceholder}\n                />\n                <div className=\"uii:flex uii:items-center uii:gap-2 uii:mt-0.5\">\n                  <span\n                    className=\"uii:text-xs uii:font-mono uii:cursor-pointer uii:text-muted-foreground\"\n                    onMouseDown={(e) => {\n                      e.preventDefault(); // Prevent blur from firing\n                      e.stopPropagation();\n                      isSwitchingToFullScreen.current = true;\n                      expressionMode.setFullScreen(true);\n\n                      // Reset flag after a short delay in case blur doesn't fire\n                      setTimeout(() => {\n                        isSwitchingToFullScreen.current = false;\n                      }, 100);\n                    }}\n                  >\n                    <FontAwesomeIcon icon={faExpand} />\n                  </span>\n                  <span\n                    className=\"uii:text-xs uii:font-mono uii:cursor-pointer uii:text-muted-foreground\"\n                    onMouseDown={(e) => {\n                      e.preventDefault(); // Prevent blur from firing\n                      handleClear();\n                    }}\n                  >\n                    Clear\n                  </span>\n                </div>\n              </div>\n            ) : (\n              <div className=\"uii:space-y-4\">\n                <FullPanelExpressionEditor\n                  value={expressionMode.expression}\n                  onChange={(newValue) => {\n                    // console.log(\"FullPanelExpressionEditor onChange called with:\", newValue);\n                    handleExpressionChange(newValue);\n                  }}\n                  onClose={() => {\n                    // Treat close like a blur - save the expression\n                    // Force blur to bypass full-screen checks\n                    handleExpressionBlur(undefined, true);\n                    expressionMode.setFullScreen(false);\n                  }}\n                  onBlur={handleExpressionBlur}\n                  onTypeInferred={handleTypeInferred}\n                  context={expressionContext}\n                  placeholder={expressionPlaceholder}\n                />\n\n                {/* AST and Dependencies Display */}\n                {(ast || dependencies.length > 0) && (\n                  <div className=\"uii:space-y-3\">\n                    {/* Return Type */}\n                    {inferredReturnType && inferredReturnType !== 'unknown' && (\n                      <div className=\"uii:space-y-2\">\n                        <div className=\"uii:flex uii:items-center uii:gap-2\">\n                          <div className=\"uii:text-sm uii:font-semibold uii:text-gray-700\">\n                            Inferred Return Type:\n                          </div>\n                          {typeScriptInferredType && inferredReturnType !== 'error' && (\n                            <span className=\"uii:px-1.5 uii:py-0.5 uii:text-xs uii:rounded uii:bg-blue-100 uii:text-blue-700 uii:border uii:border-blue-200\">\n                              TypeScript\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"uii:flex uii:items-center uii:gap-2\">\n                          {inferredReturnType === 'error' ? (\n                            <span className=\"uii:px-3 uii:py-1.5 uii:text-sm uii:font-mono uii:rounded uii:border uii:bg-red-50 uii:text-red-800 uii:border-red-200\">\n                              ❌ Syntax Error\n                            </span>\n                          ) : (\n                            <>\n                              <span className=\"uii:px-3 uii:py-1.5 uii:text-sm uii:font-mono uii:rounded uii:border uii:bg-purple-50 uii:text-purple-800 uii:border-purple-200\">\n                                {inferredReturnType}\n                              </span>\n                              {hasTypeMismatch && (\n                                <span className=\"uii:text-xs uii:text-orange-600 uii:font-semibold\">\n                                  ⚠️ Expected: {type || expectedType}\n                                </span>\n                              )}\n                            </>\n                          )}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Dependencies */}\n                    {dependencyList.length > 0 && (\n                      <div className=\"uii:space-y-2\">\n                        <div className=\"uii:text-sm uii:font-semibold uii:text-gray-700\">\n                          Dependencies ({dependencyList.length}):\n                        </div>\n                        <div className=\"uii:flex uii:flex-wrap uii:gap-2\">\n                          {dependencyList.map((dep, index) => (\n                            <span\n                              key={index}\n                              className={cn(\n                                \"uii:px-2 uii:py-1 uii:text-sm uii:rounded uii:border\",\n                                dep.exists\n                                  ? \"uii:bg-blue-100 uii:text-blue-800 uii:border-blue-200\"\n                                  : \"uii:bg-red-100 uii:text-red-800 uii:border-red-200\"\n                              )}\n                              title={dep.exists ? `Value: ${JSON.stringify(dep.value)}` : 'Not found in context'}\n                            >\n                              {dep.name}\n                            </span>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* AST Tree */}\n                    {ast && (\n                      <ASTRenderer\n                        ast={ast}\n                        tokens={tokens}\n                        variant=\"tree\"\n                        showTokens={true}\n                        className=\"uii:w-full\"\n                      />\n                    )}\n\n                    {/* Parse Status */}\n                    {isParsing && (\n                      <div className=\"uii:text-sm uii:text-gray-500 uii:italic\">\n                        Parsing expression...\n                      </div>\n                    )}\n                    {parseError && (\n                      <div className=\"uii:text-sm uii:text-red-600\">\n                        Parse Error: {parseError}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        ) : (\n          <div\n            className={cn('uii:relative', className)}\n            key={`${key}-expression-display`}\n          >\n            <div\n              className={clsx(\n                'uii:flex uii:h-9 uii:w-full uii:min-w-0 uii:rounded-sm uii:border uii:border-input uii:bg-transparent uii:px-3 uii:py-1 uii:text-base uii:shadow-xs uii:transition-[color,box-shadow] uii:outline-none uii:focus-visible:border-ring uii:focus-visible:ring-ring/50 uii:focus-visible:ring-[3px] uii:md:text-sm uii:cursor-pointer uii:hover:bg-muted/50',\n                'uii:mt-0.5 uii:bg-white uii:rounded-md uii:items-center'\n              )}\n              onClick={() => handleModeChange('editor')}\n              onMouseEnter={() => setIsHovering(true)}\n              onMouseLeave={() => setIsHovering(false)}\n            >\n              <span className=\"uii:flex-1 uii:truncate uii:text-foreground uii:items-center\">\n                {isHovering ? (\n                  // Hover state: show AST preview with dependencies\n                  <div className=\"uii:flex uii:items-center uii:gap-2\">\n                    {ast ? (\n                      <ASTRenderer\n                        key={`${key}-ast`}\n                        ast={ast}\n                        tokens={tokens}\n                        variant=\"inline\"\n                        showTokens={false}\n                        className=\"uii:text-xs\"\n                      />\n                    ) : (\n                      <div className=\"uii:text-xs uii:text-gray-500\">\n                        {isParsing\n                          ? 'Parsing...'\n                          : parseError\n                            ? `Error: ${parseError}`\n                            : 'No AST available'}\n                      </div>\n                    )}\n                    {dependencies.length > 0 && (\n                      <div className=\"uii:flex uii:gap-1\">\n                        {dependencies.map((dep, index) => (\n                          <span\n                            key={index}\n                            className=\"uii:px-1 uii:py-0.5 uii:bg-blue-100 uii:text-blue-800 uii:text-xs uii:rounded\"\n                          >\n                            {dep}\n                          </span>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                ) : (\n                  // At rest: show the expression text\n                  <span className=\"uii:font-mono uii:text-sm\">\n                    {currentExpressionValueExt || 'No expression'}\n                  </span>\n                )}\n              </span>\n            </div>\n          </div>\n        );\n\n      default:\n        return children(controlProps);\n    }\n  };\n\n  return (\n    <><div className=\"uii:flex uii:items-center uii:gap-2 uii:mt-2\"><label className=\"uii:text-xs uii:text-muted-foreground uii:font-bold\" htmlFor={key}>{label}:</label>\n      <span className=\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:text-muted-foreground uii:font-light\">{type}</span>\n      {hasTypeMismatch || inferredReturnType === 'error' ? (\n        <>\n          {expressionMode.current === 'expression' ? <><span className=\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:text-muted-foreground uii:font-light\">{expressionMode.expression.trim() !== '' ? inferredReturnType : 'empty'}</span>\n            <span className=\"uii:-mt-2 uii:inline-flex uii:px-1 uii:py-0.5 uii:bg-gray-200 uii:rounded-sm uii:text-[10px] uii:font-mono uii:font-light uii:text-orange-600 \">\n              ⚠️ Expected: {type || expectedType}\n            </span></> : <></>}</>) : <></>}\n    </div>\n      {renderContent()}\n\n      {/* {<>availableNodes:{JSON.stringify(availableNodes)}</>}<br />\n      {<>myInterface:{JSON.stringify(myInterface)}</>}<br /> */}\n      {/* {<>cv:{JSON.stringify(currentValue)}</>}<br />\n    {<>ov:{JSON.stringify(originalValue)}</>}<br />\n    {<>cevExt:{JSON.stringify(currentExpressionValueExt)}</>}<br />\n    {<>cev:{JSON.stringify(currentExpressionValue)}</>}<br />\n    {<>exp:{JSON.stringify(expressionMode.expression)}</>}<br />\n    {<>ie:{JSON.stringify(expressionMode.isEditing)}</>}<br />\n    {<>fs:{JSON.stringify(expressionMode.isFullScreen)}</>}<br />\n    {<>expm:{JSON.stringify(expressionMode.isExpressionMode)}</>}<br />\n    {<>em:{JSON.stringify(expressionMode.isEditorMode)}</>}<br /> */}\n    </>\n  );\n}\n\nexport default ExpressionWrapper;\n","import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nimport { Button } from '@/components/ui/button'\nimport { Input as InputComponent } from '@/components/ui/input'\nimport { ExpressionAST, ExpressionContext, ExpressionWrapper } from \"@/components/expression/ExpressionWrapper\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { useState } from \"react\";\n// import { faCode } from \"@fortawesome/pro-regular-svg-icons\";\nexport interface InputProps\n    extends React.InputHTMLAttributes<HTMLInputElement> { }\n\nexport interface ExpressionResult {\n    value: any;\n    ast: ExpressionAST;\n    error?: string;\n    isValid: boolean;\n    validation: {\n        syntax: boolean;\n        expression: boolean;\n        context: boolean;\n        type?: boolean;\n        security?: boolean;\n    };\n}\n\nexport function Input({ className, expectedType, ...props }: React.ComponentProps<'input'> & {\n    error?: boolean, label?: string,\n    rapperClassName?: string,\n    expressionContext?: ExpressionContext,\n    expressionResult?: ExpressionResult,\n    isEvaluating?: boolean,\n    isExpressionValid?: boolean,\n    expectedType?: string\n}) {\n\n    const [localValue, setLocalValue] = useState(props.value as any);\n    const [localMetadata, setLocalMetadata] = useState({} as any);\n\n\n    return (<ExpressionWrapper\n        label={props.label as string ?? \"Test Entry\"}\n        key={props.name as string}\n        type={expectedType ?? \"string\"}\n        valuesLoading={false}\n        value={props.value}\n        onValueChange={(val, metadata) => {\n            setLocalValue(val);\n            if (metadata) {\n                setLocalMetadata(metadata);\n            }\n        }}\n        expectedType={expectedType as \"string\" | \"number\" | \"boolean\" | \"object\" | \"array\" | \"any\"}\n        fieldName={props.name as string}\n        // availableNodes={availableNodes}\n        // myInterface={myInterface}\n        children={({ onExpressionClick, onChange: onChangeExpression, value: expressionValue, localInput, setLocalInput }) => (\n            <div className=\"uii:relative uii:text-xs uii:mt-0.5\"><InputComponent\n                type=\"text\"\n                value={localInput}\n                onChange={(e) => {\n                    setLocalInput(e.target.value)\n                    onChangeExpression(e.target.value)\n                }}\n                // disabled={!props.disabled}\n                placeholder={props.placeholder as string ?? \"Enter value...\"}\n            />\n                <div className=\"uii:flex uii:bg-white uii:border-white/40 uii:border-l-8 uii:items-center uii:gap-1 uii:absolute uii:right-1.5 uii:top-2.5 uii:cursor-pointer uii:truncate\" onClick={() => onExpressionClick()}>\n                    {/* <FontAwesomeIcon icon={[\"fas\", \"code\"]} className=\"text-blue-500\" /> */}\n                    <span className=\"uii:border-l uii:border-gray-200 uii:px-2\">Custom Expression</span>\n                </div>\n            </div>\n        )}\n    // <Button onClick={() => onExpressionClick()}>\n    //     <FontAwesomeIcon icon={[\"fas\", \"code\"]} className=\"text-blue-500\" />\n    //     <span className=\"border-l border-gray-200 px-2\">Custom Expression</span>\n    // </Button>   \n\n    // <div className=\"relative overflow-clip\">\n    //     <Input type=\"text\"\n    //         spellCheck={false}\n    //         autoComplete=\"off\"\n    //         onKeyDown={(e) => {\n    //             if (e.key === 'Enter') {\n    //                 e.preventDefault();\n    //             }\n    //         }}\n    //         autoFocus={false}\n    //         id={props.name as string} key={props.name as string}\n    //         onBlur={() => {\n    //             // onBlur && onBlur(value);\n    //         }}\n    //         name={props.name as string}\n    //         readOnly={false}\n    //         className={cn(!false ? 'cursor-not-allowed' : '', '!bg-white !text-sm ')}\n    //         defaultValue={\"\"}\n    //         value={localInput}\n    //         onChange={(e) => {\n    //             setLocalInput(e.target.value);\n    //             onChangeExpression && onChangeExpression(e.target.value);\n    //         }}\n    //     />\n    //     <div className=\"flex bg-white border-white/40 border-l-8 items-center gap-1 absolute right-1.5 top-2.5 cursor-pointer truncate\" onClick={() => onExpressionClick()}>\n    //         <FontAwesomeIcon icon={[\"fas\", \"code\"]} className=\"text-blue-500\" />\n    //         <span className=\"border-l border-gray-200 px-2\">Custom Expression</span>\n    //     </div>\n    // </div>\n\n\n    />)\n}","/**\n * Copyright 2022 Joe Bell. All rights reserved.\n *\n * This file is licensed to you under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with the\n * License. You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR REPRESENTATIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations under\n * the License.\n */ import { clsx } from \"clsx\";\nconst falsyToString = (value)=>typeof value === \"boolean\" ? `${value}` : value === 0 ? \"0\" : value;\nexport const cx = clsx;\nexport const cva = (base, config)=>(props)=>{\n        var _config_compoundVariants;\n        if ((config === null || config === void 0 ? void 0 : config.variants) == null) return cx(base, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);\n        const { variants, defaultVariants } = config;\n        const getVariantClassNames = Object.keys(variants).map((variant)=>{\n            const variantProp = props === null || props === void 0 ? void 0 : props[variant];\n            const defaultVariantProp = defaultVariants === null || defaultVariants === void 0 ? void 0 : defaultVariants[variant];\n            if (variantProp === null) return null;\n            const variantKey = falsyToString(variantProp) || falsyToString(defaultVariantProp);\n            return variants[variant][variantKey];\n        });\n        const propsWithoutUndefined = props && Object.entries(props).reduce((acc, param)=>{\n            let [key, value] = param;\n            if (value === undefined) {\n                return acc;\n            }\n            acc[key] = value;\n            return acc;\n        }, {});\n        const getCompoundVariantClassNames = config === null || config === void 0 ? void 0 : (_config_compoundVariants = config.compoundVariants) === null || _config_compoundVariants === void 0 ? void 0 : _config_compoundVariants.reduce((acc, param)=>{\n            let { class: cvClass, className: cvClassName, ...compoundVariantOptions } = param;\n            return Object.entries(compoundVariantOptions).every((param)=>{\n                let [key, value] = param;\n                return Array.isArray(value) ? value.includes({\n                    ...defaultVariants,\n                    ...propsWithoutUndefined\n                }[key]) : ({\n                    ...defaultVariants,\n                    ...propsWithoutUndefined\n                })[key] === value;\n            }) ? [\n                ...acc,\n                cvClass,\n                cvClassName\n            ] : acc;\n        }, []);\n        return cx(base, getVariantClassNames, getCompoundVariantClassNames, props === null || props === void 0 ? void 0 : props.class, props === null || props === void 0 ? void 0 : props.className);\n    };\n\n","import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"ui:inline-flex ui:items-center ui:justify-center ui:gap-2 ui:whitespace-nowrap ui:rounded-sm ui:text-sm ui:font-medium ui:transition-[color,box-shadow] ui:disabled:pointer-events-none ui:disabled:opacity-50 ui:[&_svg]:pointer-events-none ui:[&_svg:not([class*=size-])]:size-4 ui:shrink-0 ui:[&_svg]:shrink-0 ui:outline-none ui:focus-visible:border-ring ui:focus-visible:ring-ring/50 ui:focus-visible:ring-[3px] ui:aria-invalid:ring-destructive/20 ui:dark:aria-invalid:ring-destructive/40 ui:aria-invalid:border-destructive ui:cursor-pointer\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"ui:bg-primary ui:text-primary-foreground ui:shadow-xs ui:hover:bg-primary/90 ui:select-none\",\n        destructive:\n          \"ui:bg-destructive ui:text-white ui:shadow-xs ui:hover:bg-destructive/90 ui:focus-visible:ring-destructive/20 ui:dark:focus-visible:ring-destructive/40\",\n        outline:\n          \"ui:border ui:border-input ui:bg-background ui:shadow-xs ui:hover:bg-accent ui:hover:text-accent-foreground\",\n        secondary:\n          \"ui:bg-secondary ui:text-secondary-foreground ui:shadow-xs ui:hover:bg-secondary/80\",\n        ghost: \"ui:hover:bg-accent ui:hover:text-accent-foreground\",\n        link: \"ui:text-primary ui:underline-offset-4 ui:hover:underline\",\n      },\n      size: {\n        default: \"ui:h-9 ui:px-4 ui:py-2 ui:has-[>svg]:px-3\",\n        sm: \"ui:h-8 ui:rounded-sm ui:gap-1.5 ui:px-3 ui:has-[>svg]:px-2.5\",\n        lg: \"ui:h-10 ui:rounded-sm ui:px-6 ui:has-[>svg]:px-4\",\n        icon: \"ui:size-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp \n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"]}